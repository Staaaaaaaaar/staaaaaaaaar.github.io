

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/ico.svg">
  <link rel="icon" href="/img/ico.svg">
  
    <link rel="canonical" href="https://staaaaaaaaar.github.io/2025/10/14/ics-bomblab/"/>
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Sam">
  <meta name="keywords" content="">
  
    <meta name="description" content="北京大学 2025 年秋季学期计算机系统导论 - Bomb Lab">
<meta property="og:type" content="article">
<meta property="og:title" content="ICS - Bomb Lab | 拆弹！我吗？">
<meta property="og:url" content="https://staaaaaaaaar.github.io/2025/10/14/ics-bomblab/index.html">
<meta property="og:site_name" content="Sam&#39;s Blog">
<meta property="og:description" content="北京大学 2025 年秋季学期计算机系统导论 - Bomb Lab">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://staaaaaaaaar.github.io/img/ics-bomblab/phase-1.png">
<meta property="og:image" content="https://staaaaaaaaar.github.io/img/ics-bomblab/phase-2.png">
<meta property="og:image" content="https://staaaaaaaaar.github.io/img/ics-bomblab/phase-3.png">
<meta property="og:image" content="https://staaaaaaaaar.github.io/img/ics-bomblab/phase-5.png">
<meta property="article:published_time" content="2025-10-14T10:08:28.000Z">
<meta property="article:modified_time" content="2025-11-01T15:31:01.126Z">
<meta property="article:author" content="Sam">
<meta property="article:tag" content="ics">
<meta property="article:tag" content="pku">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://staaaaaaaaar.github.io/img/ics-bomblab/phase-1.png">
  
  
  
  <title>ICS - Bomb Lab | 拆弹！我吗？ - Sam&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_5041124_rijwqilvw8k.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"staaaaaaaaar.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":1},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":"3a3Cp4NiDrGee9qpOahv5XgE-gzGzoHsz","app_key":"BESWGe4b2P4LbQ81Wqhin03D","server_url":"https://3a3cp4ni.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":true},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 8.1.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Sam&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="ICS - Bomb Lab | 拆弹！我吗？"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-10-14 10:08" pubdate>
          October 14, 2025 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          29k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          238 mins
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> views
        </span>
        
      
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">ICS - Bomb Lab | 拆弹！我吗？</h1>
            
              <p id="updated-time" class="note note-info" style="">
                
                  
                    Last updated on November 1, 2025 pm
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <p>在 Bomb Lab 中，我们将要拆解一个 “二进制炸弹” 。这种 “炸弹” 本质是一个包含多阶段关卡的程序，每个阶段都要求你输入特定字符串。若输入正确，该阶段的 “炸弹” 就会被成功拆除，程序将进入下一阶段；一旦输入错误，“炸弹” 便会立刻 “引爆” ，直接终止运行。只有所有阶段全部破解，这颗 “二进制炸弹” 才算彻底解除威胁。</p>
<h1 id="预备知识"><a href="#预备知识" class="headerlink" title="预备知识"></a>预备知识</h1><h2 id="GDB-工具"><a href="#GDB-工具" class="headerlink" title="GDB 工具"></a>GDB 工具</h2><p>GDB（GNU Debugger）是一个强大的调试工具，可以帮助我们分析和调试程序。在 Bomb Lab 中，我们将使用 GDB 来逐步执行炸弹程序，观察其行为，并找到正确的输入。</p>
<h2 id="汇编语言"><a href="#汇编语言" class="headerlink" title="汇编语言"></a>汇编语言</h2><p>了解汇编语言的基本知识对于理解炸弹程序的行为至关重要。我们需要能够阅读和理解反汇编代码，清楚程序的机器级表示，以便找到每个阶段的 “拆弹密码” 。</p>
<h1 id="前置准备"><a href="#前置准备" class="headerlink" title="前置准备"></a>前置准备</h1><h2 id="熟悉-GDB-工具"><a href="#熟悉-GDB-工具" class="headerlink" title="熟悉 GDB 工具"></a>熟悉 GDB 工具</h2><p>建议事先阅读 CSAPP 中的 3.10.2 章节，这里给出部分指令参考：</p>
<table>
<thead>
<tr>
<th>指令</th>
<th>含义</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>r</td>
<td>run</td>
<td>开始执行程序，直到下一个断点或程序结束</td>
</tr>
<tr>
<td>b</td>
<td>break</td>
<td>在指定位置设置断点</td>
</tr>
<tr>
<td>q</td>
<td>quit</td>
<td>退出 GDB 调试器</td>
</tr>
<tr>
<td>ni</td>
<td>next instruction</td>
<td>执行下一条指令</td>
</tr>
<tr>
<td>si</td>
<td>step instruction</td>
<td>执行当前指令，若是函数调用则进入函数</td>
</tr>
<tr>
<td>n</td>
<td>next</td>
<td>执行下一行代码</td>
</tr>
<tr>
<td>s</td>
<td>step</td>
<td>执行下一行代码，若有函数调用则进入函数</td>
</tr>
<tr>
<td>c</td>
<td>continue</td>
<td>从当前位置继续执行程序，直到下一个断点或程序结束</td>
</tr>
<tr>
<td>p</td>
<td>print</td>
<td>打印变量的值</td>
</tr>
<tr>
<td>p $rax</td>
<td></td>
<td>打印 %rax 寄存器的值</td>
</tr>
<tr>
<td>p&#x2F;x $rsp</td>
<td></td>
<td>以十六进制打印 %rsp 寄存器的值</td>
</tr>
<tr>
<td>p&#x2F;d $rsp</td>
<td></td>
<td>以十进制打印 %rsp 寄存器的值</td>
</tr>
<tr>
<td>x</td>
<td>examine</td>
<td>打印内存中的值</td>
</tr>
<tr>
<td>x&#x2F;2x $rsp</td>
<td></td>
<td>以十六进制格式查看 %rsp 处的 2 个内存单元</td>
</tr>
<tr>
<td>x&#x2F;2c $rsp</td>
<td></td>
<td>以字符格式查看 %rsp 处的 2 个内存单元</td>
</tr>
<tr>
<td>x&#x2F;s $rsp</td>
<td></td>
<td>将 %rsp 处的内存视为 C 风格字符串查看</td>
</tr>
<tr>
<td>x&#x2F;b $rsp</td>
<td></td>
<td>查看 %rsp 处的 1 个字节内存</td>
</tr>
<tr>
<td>x&#x2F;h $rsp</td>
<td></td>
<td>查看 %rsp 处的 1 个字（2 字节）内存</td>
</tr>
<tr>
<td>x&#x2F;w $rsp</td>
<td></td>
<td>查看 %rsp 处的 1 个二字（4 字节）内存</td>
</tr>
<tr>
<td>x&#x2F;g $rsp</td>
<td></td>
<td>查看 %rsp 处的 1 个四字（8 字节）内存</td>
</tr>
<tr>
<td>j</td>
<td>jump</td>
<td>跳转到程序指定位置</td>
</tr>
<tr>
<td>layout asm</td>
<td>assembly layout</td>
<td>显示汇编代码视图</td>
</tr>
<tr>
<td>layout regs</td>
<td>register layout</td>
<td>显示寄存器状态视图</td>
</tr>
</tbody></table>
<h2 id="了解炸弹结构"><a href="#了解炸弹结构" class="headerlink" title="了解炸弹结构"></a>了解炸弹结构</h2><p>首先，查看一下给出的 <code>bomb.c</code> 文件，了解炸弹的整体结构。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span><br>&#123;<br>    <span class="hljs-comment">// ...</span><br>    input = read_line();<br>    phase_1(input);<br>    phase_defused(fp);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Phase 1 defused. How about the next one?\n&quot;</span>);<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>炸弹程序包含六个 <code>phase</code> ，每个 <code>phase</code> 都会读入一行输入，然后调用一个 <code>phase_defused</code> 函数来验证输入。</p>
<p>接着，我们反汇编 <code>bomb</code> 可执行文件，查看每个炸弹的细节。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">objdump -d bomb &gt; bomb.asm<br></code></pre></td></tr></table></figure>

<p>阅读汇编代码，我们发现每个 <code>phase</code> 函数都包含一个 <code>explode_bomb</code> 的调用指令，形如：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">27c1:	e8 <span class="hljs-number">1d</span> <span class="hljs-number">08</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br></code></pre></td></tr></table></figure>

<p>显而易见，这个函数会在输入错误时引爆炸弹，这是我们不想看到的。</p>
<h2 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h2><h3 id="设置断点"><a href="#设置断点" class="headerlink" title="设置断点"></a>设置断点</h3><p>前文提到，我们不希望程序运行 <code>explode_bomb</code> 函数，因此我们利用 <code>gdb</code> 工具给 <code>explode_bomb</code> 设置断点，防止程序继续执行到引爆炸弹的指令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">gdb bomb<br>(gdb) b explode_bomb<br></code></pre></td></tr></table></figure>

<p>同时，为了方便我们对每个 <code>phase</code> 进行调试，我们也可以在每个 <code>phase</code> 函数入口处设置断点。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">(gdb) b phase_1<br>(gdb) b phase_2<br>(gdb) b phase_3<br>(gdb) b phase_4<br>(gdb) b phase_5<br>(gdb) b phase_6<br></code></pre></td></tr></table></figure>

<h3 id="打开视图"><a href="#打开视图" class="headerlink" title="打开视图"></a>打开视图</h3><p>为了更好地观察程序每一步的执行情况以及寄存器状态，我们可以打开汇编代码视图和寄存器状态视图。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">(gdb) layout asm<br>(gdb) layout regs<br></code></pre></td></tr></table></figure>

<h3 id="输入重定向"><a href="#输入重定向" class="headerlink" title="输入重定向"></a>输入重定向</h3><p>查看原代码发现，<code>bomb.c</code> 程序提供了文件读入的方式。为方便调试，我们可以将输入重定向到一个文件 <code>psol.txt</code> 中。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gdb bomb psol.txt<br></code></pre></td></tr></table></figure>

<h3 id="添加默认配置"><a href="#添加默认配置" class="headerlink" title="添加默认配置"></a>添加默认配置</h3><p>为了避免每次启动 <code>gdb</code> 都要手动设置断点，我们可以在当前目录下创建一个 <code>.gdbinit</code> 文件来设置 <code>gdb</code> 进入时的一些默认配置。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 创建当前目录下的 .gdbinit 文件</span><br><span class="hljs-built_in">touch</span> .gdbinit<br><span class="hljs-comment"># 创建 .config/gdb 文件夹</span><br><span class="hljs-built_in">mkdir</span> -p ~/.config/gdb<br><span class="hljs-comment"># 允许 gdb 预加载根目录下所有的文件</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;set auto-load safe-path /&quot;</span> &gt; ~/.config/gdb/gdbinit<br></code></pre></td></tr></table></figure>

<p>在 <code>.gdbinit</code> 中添加默认配置：</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-keyword">set</span> args <span class="hljs-comment">psol.txt</span><br><br>layout <span class="hljs-comment">asm</span><br>layout <span class="hljs-comment">regs</span><br><br>b <span class="hljs-comment">explode_bomb</span><br><br>b <span class="hljs-comment">phase_1</span><br>b <span class="hljs-comment">phase_2</span><br>b <span class="hljs-comment">phase_3</span><br>b <span class="hljs-comment">phase_4</span><br>b <span class="hljs-comment">phase_5</span><br>b <span class="hljs-comment">phase_6</span><br><br>r<br></code></pre></td></tr></table></figure>

<p>完成这些之后，我们就可以直接运行 <code>gdb bomb</code> 来开始拆弹了。</p>
<h1 id="Phase-1"><a href="#Phase-1" class="headerlink" title="Phase 1"></a>Phase 1</h1><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">00000000000027a4 &lt;phase_1&gt;:<br>    27a4:	f3 0f 1e fa          	endbr64<br>    27a8:	<span class="hljs-number">48</span> <span class="hljs-number">83</span> ec <span class="hljs-number">08</span>          	<span class="hljs-keyword">sub</span>    <span class="hljs-number">$0</span>x8,%rsp<br>    27ac:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">35</span> <span class="hljs-number">05</span> 2a <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x2a05</span>(%rip),%rsi        # 51b8 &lt;_IO_stdin_used+<span class="hljs-number">0x1b8</span>&gt;<br>    27b3:	e8 <span class="hljs-number">16</span> <span class="hljs-number">05</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2cce &lt;strings_not_equal&gt;<br>    27b8:	<span class="hljs-number">85</span> c0                	<span class="hljs-keyword">test</span>   %eax,%eax<br>    27ba:	<span class="hljs-number">75</span> <span class="hljs-number">05</span>                	<span class="hljs-keyword">jne</span>    27c1 &lt;phase_1+<span class="hljs-number">0x1d</span>&gt;<br>    27bc:	<span class="hljs-number">48</span> <span class="hljs-number">83</span> c4 <span class="hljs-number">08</span>          	<span class="hljs-keyword">add</span>    <span class="hljs-number">$0</span>x8,%rsp<br>    27c0:	c3                   	<span class="hljs-keyword">ret</span><br>    27c1:	e8 <span class="hljs-number">1d</span> <span class="hljs-number">08</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br>    27c6:	eb f4                	<span class="hljs-keyword">jmp</span>    27bc &lt;phase_1+<span class="hljs-number">0x18</span>&gt;<br></code></pre></td></tr></table></figure>

<p>从汇编代码中可以看出，<code>phase_1</code> 函数调用了 <code>strings_not_equal</code> 函数来比较输入字符串和某个预设字符串是否相等。因此，我们只需要在执行 <code>call strings_not_equal</code> 之前，获取到 <code>%rsi</code> 指向的字符串即可。</p>
<p><img src="/img/ics-bomblab/phase-1.png" srcset="/img/loading.gif" lazyload></p>
<p>可见 phase 1 的答案就是：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">We can be both of God and the devil. Since we&#x27;re trying to raise the dead against the stream of time.<br></code></pre></td></tr></table></figure>

<h1 id="Phase-2"><a href="#Phase-2" class="headerlink" title="Phase 2"></a>Phase 2</h1><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">00000000000027c8 &lt;phase_2&gt;:<br>    27c8:	f3 0f 1e fa          	endbr64<br>    27cc:	<span class="hljs-number">53</span>                   	<span class="hljs-keyword">push</span>   %rbx<br>    27cd:	<span class="hljs-number">48</span> <span class="hljs-number">83</span> ec <span class="hljs-number">20</span>          	<span class="hljs-keyword">sub</span>    <span class="hljs-number">$0</span>x20,%rsp<br>    27d1:	<span class="hljs-number">64</span> <span class="hljs-number">48</span> 8b <span class="hljs-number">04</span> <span class="hljs-number">25</span> <span class="hljs-number">28</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">mov</span>    %fs:<span class="hljs-number">0x28</span>,%rax<br>    27d8:	<span class="hljs-number">00</span> <span class="hljs-number">00</span><br>    27da:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">18</span>       	<span class="hljs-keyword">mov</span>    %rax,<span class="hljs-number">0x18</span>(%rsp)<br>    27df:	<span class="hljs-number">31</span> c0                	<span class="hljs-keyword">xor</span>    %eax,%eax<br>    27e1:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> e6             	<span class="hljs-keyword">mov</span>    %rsp,%rsi<br>    27e4:	e8 <span class="hljs-number">80</span> <span class="hljs-number">08</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   <span class="hljs-number">3069</span> &lt;read_six_numbers&gt;<br>    27e9:	<span class="hljs-number">83</span> 3c <span class="hljs-number">24</span> <span class="hljs-number">00</span>          	cmpl   <span class="hljs-number">$0</span>x0,(%rsp)<br>    27ed:	<span class="hljs-number">75</span> <span class="hljs-number">07</span>                	<span class="hljs-keyword">jne</span>    27f6 &lt;phase_2+<span class="hljs-number">0x2e</span>&gt;<br>    27ef:	<span class="hljs-number">83</span> 7c <span class="hljs-number">24</span> <span class="hljs-number">04</span> <span class="hljs-number">01</span>       	cmpl   <span class="hljs-number">$0</span>x1,<span class="hljs-number">0x4</span>(%rsp)<br>    27f4:	<span class="hljs-number">74</span> <span class="hljs-number">05</span>                	<span class="hljs-keyword">je</span>     27fb &lt;phase_2+<span class="hljs-number">0x33</span>&gt;<br>    27f6:	e8 e8 <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br>    27fb:	bb <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x2,%ebx<br>    <span class="hljs-number">2800</span>:	eb <span class="hljs-number">03</span>                	<span class="hljs-keyword">jmp</span>    <span class="hljs-number">2805</span> &lt;phase_2+<span class="hljs-number">0x3d</span>&gt;<br>    <span class="hljs-number">2802</span>:	<span class="hljs-number">83</span> c3 <span class="hljs-number">01</span>             	<span class="hljs-keyword">add</span>    <span class="hljs-number">$0</span>x1,%ebx<br>    <span class="hljs-number">2805</span>:	<span class="hljs-number">83</span> fb <span class="hljs-number">05</span>             	<span class="hljs-keyword">cmp</span>    <span class="hljs-number">$0</span>x5,%ebx<br>    <span class="hljs-number">2808</span>:	7f <span class="hljs-number">24</span>                	<span class="hljs-keyword">jg</span>     282e &lt;phase_2+<span class="hljs-number">0x66</span>&gt;<br>    280a:	<span class="hljs-number">48</span> <span class="hljs-number">63</span> c3             	movslq %ebx,%rax<br>    <span class="hljs-number">280d</span>:	<span class="hljs-number">8d</span> <span class="hljs-number">53</span> fe             	<span class="hljs-keyword">lea</span>    -<span class="hljs-number">0x2</span>(%rbx),%edx<br>    <span class="hljs-number">2810</span>:	<span class="hljs-number">48</span> <span class="hljs-number">63</span> d2             	movslq %edx,%rdx<br>    <span class="hljs-number">2813</span>:	8b 0c <span class="hljs-number">94</span>             	<span class="hljs-keyword">mov</span>    (%rsp,%rdx,<span class="hljs-number">4</span>),%ecx<br>    <span class="hljs-number">2816</span>:	<span class="hljs-number">8d</span> <span class="hljs-number">53</span> ff             	<span class="hljs-keyword">lea</span>    -<span class="hljs-number">0x1</span>(%rbx),%edx<br>    <span class="hljs-number">2819</span>:	<span class="hljs-number">48</span> <span class="hljs-number">63</span> d2             	movslq %edx,%rdx<br>    281c:	8b <span class="hljs-number">14</span> <span class="hljs-number">94</span>             	<span class="hljs-keyword">mov</span>    (%rsp,%rdx,<span class="hljs-number">4</span>),%edx<br>    281f:	<span class="hljs-number">8d</span> <span class="hljs-number">14</span> 4a             	<span class="hljs-keyword">lea</span>    (%rdx,%rcx,<span class="hljs-number">2</span>),%edx<br>    <span class="hljs-number">2822</span>:	<span class="hljs-number">39</span> <span class="hljs-number">14</span> <span class="hljs-number">84</span>             	<span class="hljs-keyword">cmp</span>    %edx,(%rsp,%rax,<span class="hljs-number">4</span>)<br>    <span class="hljs-number">2825</span>:	<span class="hljs-number">74</span> <span class="hljs-built_in">db</span>                	<span class="hljs-keyword">je</span>     <span class="hljs-number">2802</span> &lt;phase_2+<span class="hljs-number">0x3a</span>&gt;<br>    <span class="hljs-number">2827</span>:	e8 b7 <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br>    282c:	eb d4                	<span class="hljs-keyword">jmp</span>    <span class="hljs-number">2802</span> &lt;phase_2+<span class="hljs-number">0x3a</span>&gt;<br>    282e:	<span class="hljs-number">48</span> 8b <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">18</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">0x18</span>(%rsp),%rax<br>    <span class="hljs-number">2833</span>:	<span class="hljs-number">64</span> <span class="hljs-number">48</span> 2b <span class="hljs-number">04</span> <span class="hljs-number">25</span> <span class="hljs-number">28</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">sub</span>    %fs:<span class="hljs-number">0x28</span>,%rax<br>    283a:	<span class="hljs-number">00</span> <span class="hljs-number">00</span><br>    283c:	<span class="hljs-number">75</span> <span class="hljs-number">06</span>                	<span class="hljs-keyword">jne</span>    <span class="hljs-number">2844</span> &lt;phase_2+<span class="hljs-number">0x7c</span>&gt;<br>    283e:	<span class="hljs-number">48</span> <span class="hljs-number">83</span> c4 <span class="hljs-number">20</span>          	<span class="hljs-keyword">add</span>    <span class="hljs-number">$0</span>x20,%rsp<br>    <span class="hljs-number">2842</span>:	5b                   	<span class="hljs-keyword">pop</span>    %rbx<br>    <span class="hljs-number">2843</span>:	c3                   	<span class="hljs-keyword">ret</span><br>    <span class="hljs-number">2844</span>:	e8 <span class="hljs-number">67</span> fa ff ff       	<span class="hljs-keyword">call</span>   22b0 &lt;__stack_chk_fail@plt&gt;<br></code></pre></td></tr></table></figure>

<p>phase 2 相较于 phase 1 复杂了一些，我们一步一步拆解。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">00000000000027c8 &lt;phase_2&gt;:<br>    <span class="hljs-comment">; ...</span><br>    27da:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">18</span>       	<span class="hljs-keyword">mov</span>    %rax,<span class="hljs-number">0x18</span>(%rsp)<br>    27df:	<span class="hljs-number">31</span> c0                	<span class="hljs-keyword">xor</span>    %eax,%eax<br>    27e1:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> e6             	<span class="hljs-keyword">mov</span>    %rsp,%rsi<br>    27e4:	e8 <span class="hljs-number">80</span> <span class="hljs-number">08</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   <span class="hljs-number">3069</span> &lt;read_six_numbers&gt;<br>    27e9:	<span class="hljs-number">83</span> 3c <span class="hljs-number">24</span> <span class="hljs-number">00</span>          	cmpl   <span class="hljs-number">$0</span>x0,(%rsp)<br>    27ed:	<span class="hljs-number">75</span> <span class="hljs-number">07</span>                	<span class="hljs-keyword">jne</span>    27f6 &lt;phase_2+<span class="hljs-number">0x2e</span>&gt;<br>    <span class="hljs-comment">; ...</span><br>    27f6:	e8 e8 <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br></code></pre></td></tr></table></figure>

<p>程序首先调用 <code>read_six_numbers</code> 读取 6 个数，然后将 (%rsp) 与 0 进行比较，如果不等于 0 则引爆炸弹。我们可以先尝试性地输入 <code>1 2 3 4 5 6</code> ，在程序运行到 <code>cmpl $0x0,(%rsp)</code> 时，查看 <code>(%rsp)</code> 的内容。</p>
<p><img src="/img/ics-bomblab/phase-2.png" srcset="/img/loading.gif" lazyload></p>
<p>可见输入的 6 个数被保存在以 <code>%rsp</code> 为起始地址的内存中，每个数占 4 个字节。知道了这一点，后面的分析就简单多了。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">00000000000027c8 &lt;phase_2&gt;:<br>    <span class="hljs-comment">; ...</span><br>    27e4:	e8 <span class="hljs-number">80</span> <span class="hljs-number">08</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   <span class="hljs-number">3069</span> &lt;read_six_numbers&gt;<br>    27e9:	<span class="hljs-number">83</span> 3c <span class="hljs-number">24</span> <span class="hljs-number">00</span>          	cmpl   <span class="hljs-number">$0</span>x0,(%rsp)  <span class="hljs-comment">; numbers[0] = 0</span><br>    27ed:	<span class="hljs-number">75</span> <span class="hljs-number">07</span>                	<span class="hljs-keyword">jne</span>    27f6 &lt;phase_2+<span class="hljs-number">0x2e</span>&gt;<br>    27ef:	<span class="hljs-number">83</span> 7c <span class="hljs-number">24</span> <span class="hljs-number">04</span> <span class="hljs-number">01</span>       	cmpl   <span class="hljs-number">$0</span>x1,<span class="hljs-number">0x4</span>(%rsp)  <span class="hljs-comment">; numbers[1] = 1</span><br>    27f4:	<span class="hljs-number">74</span> <span class="hljs-number">05</span>                	<span class="hljs-keyword">je</span>     27fb &lt;phase_2+<span class="hljs-number">0x33</span>&gt;<br>    27f6:	e8 e8 <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br>    27fb:	bb <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x2,%ebx<br>    <span class="hljs-number">2800</span>:	eb <span class="hljs-number">03</span>                	<span class="hljs-keyword">jmp</span>    <span class="hljs-number">2805</span> &lt;phase_2+<span class="hljs-number">0x3d</span>&gt;<br>    <span class="hljs-number">2802</span>:	<span class="hljs-number">83</span> c3 <span class="hljs-number">01</span>             	<span class="hljs-keyword">add</span>    <span class="hljs-number">$0</span>x1,%ebx<br>    <span class="hljs-number">2805</span>:	<span class="hljs-number">83</span> fb <span class="hljs-number">05</span>             	<span class="hljs-keyword">cmp</span>    <span class="hljs-number">$0</span>x5,%ebx<br>    <span class="hljs-number">2808</span>:	7f <span class="hljs-number">24</span>                	<span class="hljs-keyword">jg</span>     282e &lt;phase_2+<span class="hljs-number">0x66</span>&gt;  <span class="hljs-comment">; if (%ebx &gt; 5) done</span><br>    280a:	<span class="hljs-number">48</span> <span class="hljs-number">63</span> c3             	movslq %ebx,%rax<br>    <span class="hljs-number">280d</span>:	<span class="hljs-number">8d</span> <span class="hljs-number">53</span> fe             	<span class="hljs-keyword">lea</span>    -<span class="hljs-number">0x2</span>(%rbx),%edx<br>    <span class="hljs-number">2810</span>:	<span class="hljs-number">48</span> <span class="hljs-number">63</span> d2             	movslq %edx,%rdx<br>    <span class="hljs-number">2813</span>:	8b 0c <span class="hljs-number">94</span>             	<span class="hljs-keyword">mov</span>    (%rsp,%rdx,<span class="hljs-number">4</span>),%ecx  <span class="hljs-comment">; a = numbers[%rbx-2]</span><br>    <span class="hljs-number">2816</span>:	<span class="hljs-number">8d</span> <span class="hljs-number">53</span> ff             	<span class="hljs-keyword">lea</span>    -<span class="hljs-number">0x1</span>(%rbx),%edx<br>    <span class="hljs-number">2819</span>:	<span class="hljs-number">48</span> <span class="hljs-number">63</span> d2             	movslq %edx,%rdx<br>    281c:	8b <span class="hljs-number">14</span> <span class="hljs-number">94</span>             	<span class="hljs-keyword">mov</span>    (%rsp,%rdx,<span class="hljs-number">4</span>),%edx  <span class="hljs-comment">; b = numbers[%rbx-1]</span><br>    281f:	<span class="hljs-number">8d</span> <span class="hljs-number">14</span> 4a             	<span class="hljs-keyword">lea</span>    (%rdx,%rcx,<span class="hljs-number">2</span>),%edx  <span class="hljs-comment">; c = 2*a + b</span><br>    <span class="hljs-number">2822</span>:	<span class="hljs-number">39</span> <span class="hljs-number">14</span> <span class="hljs-number">84</span>             	<span class="hljs-keyword">cmp</span>    %edx,(%rsp,%rax,<span class="hljs-number">4</span>)  <span class="hljs-comment">; numbers[%rbx] = c</span><br>    <span class="hljs-number">2825</span>:	<span class="hljs-number">74</span> <span class="hljs-built_in">db</span>                	<span class="hljs-keyword">je</span>     <span class="hljs-number">2802</span> &lt;phase_2+<span class="hljs-number">0x3a</span>&gt;<br>    <span class="hljs-number">2827</span>:	e8 b7 <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br>    282c:	eb d4                	<span class="hljs-keyword">jmp</span>    <span class="hljs-number">2802</span> &lt;phase_2+<span class="hljs-number">0x3a</span>&gt;<br>    282e:	<span class="hljs-number">48</span> 8b <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">18</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">0x18</span>(%rsp),%rax<br>    <span class="hljs-comment">; ...</span><br></code></pre></td></tr></table></figure>

<p>对关键步分析后，我们可以总结出 phase 2 的要求：</p>
<ol>
<li>输入的第一个数必须为 0</li>
<li>输入的第二个数必须为 1</li>
<li>从第三个数开始，必须满足 <code>numbers[i] = 2 * numbers[i-2] + numbers[i-1]</code> 的关系</li>
</ol>
<p>根据上述要求，我们可以计算出 phase 2 的答案：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">0 1 1 3 5 11<br></code></pre></td></tr></table></figure>

<h1 id="Phase-3"><a href="#Phase-3" class="headerlink" title="Phase 3"></a>Phase 3</h1><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-number">0000000000002849</span> &lt;phase_3&gt;:<br>    <span class="hljs-number">2849</span>:	f3 0f 1e fa          	endbr64<br>    <span class="hljs-number">284d</span>:	<span class="hljs-number">48</span> <span class="hljs-number">83</span> ec <span class="hljs-number">18</span>          	<span class="hljs-keyword">sub</span>    <span class="hljs-number">$0</span>x18,%rsp<br>    <span class="hljs-number">2851</span>:	<span class="hljs-number">64</span> <span class="hljs-number">48</span> 8b <span class="hljs-number">04</span> <span class="hljs-number">25</span> <span class="hljs-number">28</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">mov</span>    %fs:<span class="hljs-number">0x28</span>,%rax<br>    <span class="hljs-number">2858</span>:	<span class="hljs-number">00</span> <span class="hljs-number">00</span><br>    285a:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">08</span>       	<span class="hljs-keyword">mov</span>    %rax,<span class="hljs-number">0x8</span>(%rsp)<br>    285f:	<span class="hljs-number">31</span> c0                	<span class="hljs-keyword">xor</span>    %eax,%eax<br>    <span class="hljs-number">2861</span>:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> 4c <span class="hljs-number">24</span> <span class="hljs-number">04</span>       	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x4</span>(%rsp),%rcx<br>    <span class="hljs-number">2866</span>:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> e2             	<span class="hljs-keyword">mov</span>    %rsp,%rdx<br>    <span class="hljs-number">2869</span>:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">35</span> f8 <span class="hljs-number">2d</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x2df8</span>(%rip),%rsi        # <span class="hljs-number">5668</span> &lt;array<span class="hljs-number">.0</span>+<span class="hljs-number">0x328</span>&gt;<br>    <span class="hljs-number">2870</span>:	e8 eb fa ff ff       	<span class="hljs-keyword">call</span>   <span class="hljs-number">2360</span> &lt;__isoc99_sscanf@plt&gt;<br>    <span class="hljs-number">2875</span>:	<span class="hljs-number">83</span> f8 <span class="hljs-number">01</span>             	<span class="hljs-keyword">cmp</span>    <span class="hljs-number">$0</span>x1,%eax<br>    <span class="hljs-number">2878</span>:	7e 1a                	<span class="hljs-keyword">jle</span>    <span class="hljs-number">2894</span> &lt;phase_3+<span class="hljs-number">0x4b</span>&gt;<br>    287a:	<span class="hljs-number">83</span> 3c <span class="hljs-number">24</span> <span class="hljs-number">07</span>          	cmpl   <span class="hljs-number">$0</span>x7,(%rsp)<br>    287e:	<span class="hljs-number">77</span> <span class="hljs-number">65</span>                	<span class="hljs-keyword">ja</span>     28e5 &lt;phase_3+<span class="hljs-number">0x9c</span>&gt;<br>    <span class="hljs-number">2880</span>:	8b <span class="hljs-number">04</span> <span class="hljs-number">24</span>             	<span class="hljs-keyword">mov</span>    (%rsp),%eax<br>    <span class="hljs-number">2883</span>:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">15</span> <span class="hljs-number">96</span> 2a <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x2a96</span>(%rip),%rdx        # <span class="hljs-number">5320</span> &lt;_IO_stdin_used+<span class="hljs-number">0x320</span>&gt;<br>    288a:	<span class="hljs-number">48</span> <span class="hljs-number">63</span> <span class="hljs-number">04</span> <span class="hljs-number">82</span>          	movslq (%rdx,%rax,<span class="hljs-number">4</span>),%rax<br>    288e:	<span class="hljs-number">48</span> <span class="hljs-number">01</span> d0             	<span class="hljs-keyword">add</span>    %rdx,%rax<br>    <span class="hljs-number">2891</span>:	3e ff e0             	notrack <span class="hljs-keyword">jmp</span> *%rax<br>    <span class="hljs-number">2894</span>:	e8 4a <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br>    <span class="hljs-number">2899</span>:	eb df                	<span class="hljs-keyword">jmp</span>    287a &lt;phase_3+<span class="hljs-number">0x31</span>&gt;<br>    289b:	b8 f5 <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x1f5,%eax<br>    28a0:	<span class="hljs-number">39</span> <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">04</span>          	<span class="hljs-keyword">cmp</span>    %eax,<span class="hljs-number">0x4</span>(%rsp)<br>    28a4:	<span class="hljs-number">75</span> <span class="hljs-number">52</span>                	<span class="hljs-keyword">jne</span>    28f8 &lt;phase_3+<span class="hljs-number">0xaf</span>&gt;<br>    28a6:	<span class="hljs-number">48</span> 8b <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">08</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">0x8</span>(%rsp),%rax<br>    28ab:	<span class="hljs-number">64</span> <span class="hljs-number">48</span> 2b <span class="hljs-number">04</span> <span class="hljs-number">25</span> <span class="hljs-number">28</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">sub</span>    %fs:<span class="hljs-number">0x28</span>,%rax<br>    28b2:	<span class="hljs-number">00</span> <span class="hljs-number">00</span><br>    28b4:	<span class="hljs-number">75</span> <span class="hljs-number">49</span>                	<span class="hljs-keyword">jne</span>    28ff &lt;phase_3+<span class="hljs-number">0xb6</span>&gt;<br>    28b6:	<span class="hljs-number">48</span> <span class="hljs-number">83</span> c4 <span class="hljs-number">18</span>          	<span class="hljs-keyword">add</span>    <span class="hljs-number">$0</span>x18,%rsp<br>    28ba:	c3                   	<span class="hljs-keyword">ret</span><br>    28bb:	b8 3b <span class="hljs-number">03</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x33b,%eax<br>    28c0:	eb de                	<span class="hljs-keyword">jmp</span>    28a0 &lt;phase_3+<span class="hljs-number">0x57</span>&gt;<br>    28c2:	b8 <span class="hljs-number">83</span> <span class="hljs-number">03</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x383,%eax<br>    28c7:	eb d7                	<span class="hljs-keyword">jmp</span>    28a0 &lt;phase_3+<span class="hljs-number">0x57</span>&gt;<br>    28c9:	b8 c0 <span class="hljs-number">03</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x3c0,%eax<br>    28ce:	eb d0                	<span class="hljs-keyword">jmp</span>    28a0 &lt;phase_3+<span class="hljs-number">0x57</span>&gt;<br>    28d0:	b8 <span class="hljs-number">96</span> <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x296,%eax<br>    28d5:	eb c9                	<span class="hljs-keyword">jmp</span>    28a0 &lt;phase_3+<span class="hljs-number">0x57</span>&gt;<br>    28d7:	b8 fe <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x2fe,%eax<br>    28dc:	eb c2                	<span class="hljs-keyword">jmp</span>    28a0 &lt;phase_3+<span class="hljs-number">0x57</span>&gt;<br>    28de:	b8 7e <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x27e,%eax<br>    28e3:	eb bb                	<span class="hljs-keyword">jmp</span>    28a0 &lt;phase_3+<span class="hljs-number">0x57</span>&gt;<br>    28e5:	e8 f9 <span class="hljs-number">06</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br>    28ea:	b8 <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x0,%eax<br>    28ef:	eb af                	<span class="hljs-keyword">jmp</span>    28a0 &lt;phase_3+<span class="hljs-number">0x57</span>&gt;<br>    28f1:	b8 <span class="hljs-number">11</span> <span class="hljs-number">03</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x311,%eax<br>    28f6:	eb a8                	<span class="hljs-keyword">jmp</span>    28a0 &lt;phase_3+<span class="hljs-number">0x57</span>&gt;<br>    28f8:	e8 e6 <span class="hljs-number">06</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br>    28fd:	eb a7                	<span class="hljs-keyword">jmp</span>    28a6 &lt;phase_3+<span class="hljs-number">0x5d</span>&gt;<br>    28ff:	e8 ac f9 ff ff       	<span class="hljs-keyword">call</span>   22b0 &lt;__stack_chk_fail@plt&gt;<br></code></pre></td></tr></table></figure>

<p>注意到 phase 3 开头调用了 <code>__isoc99_sscanf@plt</code> 函数读取输入，同时我们也知道函数调用传入的参数会被依次放在 <code>%rdi</code>、<code>%rsi</code>、<code>%rdx</code>、<code>%rcx</code> 等寄存器中。因此，我们可以在执行 <code>__isoc99_sscanf@plt</code> 的调用前，查看这些寄存器的值来推测输入的内容。</p>
<p><img src="/img/ics-bomblab/phase-3.png" srcset="/img/loading.gif" lazyload></p>
<p>可见输入的格式为两个整数。参考 phase 2，猜测两个整数被存放在 <code>%rsp</code> 和 <code>0x4(%rsp)</code> 处（事实上确实如此，可通过调试验证）。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-number">0000000000002849</span> &lt;phase_3&gt;:<br>    <span class="hljs-comment">; ...</span><br>    287a:	<span class="hljs-number">83</span> 3c <span class="hljs-number">24</span> <span class="hljs-number">07</span>          	cmpl   <span class="hljs-number">$0</span>x7,(%rsp)<br>    287e:	<span class="hljs-number">77</span> <span class="hljs-number">65</span>                	<span class="hljs-keyword">ja</span>     28e5 &lt;phase_3+<span class="hljs-number">0x9c</span>&gt;<br>    <span class="hljs-comment">; ...</span><br>    28e5:	e8 f9 <span class="hljs-number">06</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br>    <span class="hljs-comment">; ...</span><br></code></pre></td></tr></table></figure>

<p>输入的第一个整数必须小于等于 7，否则引爆炸弹。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-number">0000000000002849</span> &lt;phase_3&gt;:<br>    <span class="hljs-comment">; ...</span><br>    <span class="hljs-number">2880</span>:	8b <span class="hljs-number">04</span> <span class="hljs-number">24</span>             	<span class="hljs-keyword">mov</span>    (%rsp),%eax<br>    <span class="hljs-number">2883</span>:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">15</span> <span class="hljs-number">96</span> 2a <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x2a96</span>(%rip),%rdx        # <span class="hljs-number">5320</span> &lt;_IO_stdin_used+<span class="hljs-number">0x320</span>&gt;<br>    288a:	<span class="hljs-number">48</span> <span class="hljs-number">63</span> <span class="hljs-number">04</span> <span class="hljs-number">82</span>          	movslq (%rdx,%rax,<span class="hljs-number">4</span>),%rax<br>    288e:	<span class="hljs-number">48</span> <span class="hljs-number">01</span> d0             	<span class="hljs-keyword">add</span>    %rdx,%rax<br>    <span class="hljs-number">2891</span>:	3e ff e0             	notrack <span class="hljs-keyword">jmp</span> *%rax<br>    <span class="hljs-number">2894</span>:	e8 4a <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br>    <span class="hljs-comment">; ...</span><br></code></pre></td></tr></table></figure>

<p>这段汇编代码依赖于输入的第一个整数跳转到不同的位置，类似于跳转表的结构。我们可以随机输入一个数字来看看跳转到了什么位置，进而只需满足对应分支的处理即可。我们以输入 <code>2</code> 为例，发现跳转到了 <code>28bb</code> 处。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-number">0000000000002849</span> &lt;phase_3&gt;:<br>    <span class="hljs-comment">; ...</span><br>    28a0:	<span class="hljs-number">39</span> <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">04</span>          	<span class="hljs-keyword">cmp</span>    %eax,<span class="hljs-number">0x4</span>(%rsp)<br>    28a4:	<span class="hljs-number">75</span> <span class="hljs-number">52</span>                	<span class="hljs-keyword">jne</span>    28f8 &lt;phase_3+<span class="hljs-number">0xaf</span>&gt;  <span class="hljs-comment">; if (input[1] != eax) explode_bomb()</span><br>    28a6:	<span class="hljs-number">48</span> 8b <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">08</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">0x8</span>(%rsp),%rax<br>    28ab:	<span class="hljs-number">64</span> <span class="hljs-number">48</span> 2b <span class="hljs-number">04</span> <span class="hljs-number">25</span> <span class="hljs-number">28</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">sub</span>    %fs:<span class="hljs-number">0x28</span>,%rax<br>    28b2:	<span class="hljs-number">00</span> <span class="hljs-number">00</span><br>    28b4:	<span class="hljs-number">75</span> <span class="hljs-number">49</span>                	<span class="hljs-keyword">jne</span>    28ff &lt;phase_3+<span class="hljs-number">0xb6</span>&gt;<br>    28b6:	<span class="hljs-number">48</span> <span class="hljs-number">83</span> c4 <span class="hljs-number">18</span>          	<span class="hljs-keyword">add</span>    <span class="hljs-number">$0</span>x18,%rsp<br>    28ba:	c3                   	<span class="hljs-keyword">ret</span><br>    <span class="hljs-comment">; ...</span><br>    28bb:	b8 3b <span class="hljs-number">03</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x33b,%eax  <span class="hljs-comment">; eax = 0x33b</span><br>    28c0:	eb de                	<span class="hljs-keyword">jmp</span>    28a0 &lt;phase_3+<span class="hljs-number">0x57</span>&gt;<br></code></pre></td></tr></table></figure>

<p>由此可知，输入的第二个整数必须等于 0x33b（即 827）。综上，phase 3 的答案之一为：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">2 827<br></code></pre></td></tr></table></figure>

<h1 id="Phase-4"><a href="#Phase-4" class="headerlink" title="Phase 4"></a>Phase 4</h1><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-number">0000000000002904</span> &lt;func4&gt;:<br>    <span class="hljs-number">2904</span>:	f3 0f 1e fa          	endbr64<br>    <span class="hljs-number">2908</span>:	<span class="hljs-number">53</span>                   	<span class="hljs-keyword">push</span>   %rbx<br>    <span class="hljs-number">2909</span>:	<span class="hljs-number">89</span> d0                	<span class="hljs-keyword">mov</span>    %edx,%eax<br>    290b:	<span class="hljs-number">29</span> f0                	<span class="hljs-keyword">sub</span>    %esi,%eax<br>    <span class="hljs-number">290d</span>:	<span class="hljs-number">89</span> c3                	<span class="hljs-keyword">mov</span>    %eax,%ebx<br>    290f:	c1 eb 1f             	<span class="hljs-keyword">shr</span>    <span class="hljs-number">$0</span>x1f,%ebx<br>    <span class="hljs-number">2912</span>:	<span class="hljs-number">01</span> c3                	<span class="hljs-keyword">add</span>    %eax,%ebx<br>    <span class="hljs-number">2914</span>:	d1 fb                	<span class="hljs-keyword">sar</span>    <span class="hljs-number">$1</span>,%ebx<br>    <span class="hljs-number">2916</span>:	<span class="hljs-number">01</span> f3                	<span class="hljs-keyword">add</span>    %esi,%ebx<br>    <span class="hljs-number">2918</span>:	<span class="hljs-number">39</span> fb                	<span class="hljs-keyword">cmp</span>    %edi,%ebx<br>    291a:	7f <span class="hljs-number">06</span>                	<span class="hljs-keyword">jg</span>     <span class="hljs-number">2922</span> &lt;func4+<span class="hljs-number">0x1e</span>&gt;<br>    291c:	7c <span class="hljs-number">10</span>                	<span class="hljs-keyword">jl</span>     292e &lt;func4+<span class="hljs-number">0x2a</span>&gt;<br>    291e:	<span class="hljs-number">89</span> d8                	<span class="hljs-keyword">mov</span>    %ebx,%eax<br>    <span class="hljs-number">2920</span>:	5b                   	<span class="hljs-keyword">pop</span>    %rbx<br>    <span class="hljs-number">2921</span>:	c3                   	<span class="hljs-keyword">ret</span><br>    <span class="hljs-number">2922</span>:	<span class="hljs-number">8d</span> <span class="hljs-number">53</span> ff             	<span class="hljs-keyword">lea</span>    -<span class="hljs-number">0x1</span>(%rbx),%edx<br>    <span class="hljs-number">2925</span>:	e8 da ff ff ff       	<span class="hljs-keyword">call</span>   <span class="hljs-number">2904</span> &lt;func4&gt;<br>    292a:	<span class="hljs-number">01</span> c3                	<span class="hljs-keyword">add</span>    %eax,%ebx<br>    292c:	eb f0                	<span class="hljs-keyword">jmp</span>    291e &lt;func4+<span class="hljs-number">0x1a</span>&gt;<br>    292e:	<span class="hljs-number">8d</span> <span class="hljs-number">73</span> <span class="hljs-number">01</span>             	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x1</span>(%rbx),%esi<br>    <span class="hljs-number">2931</span>:	e8 ce ff ff ff       	<span class="hljs-keyword">call</span>   <span class="hljs-number">2904</span> &lt;func4&gt;<br>    <span class="hljs-number">2936</span>:	<span class="hljs-number">01</span> c3                	<span class="hljs-keyword">add</span>    %eax,%ebx<br>    <span class="hljs-number">2938</span>:	eb e4                	<span class="hljs-keyword">jmp</span>    291e &lt;func4+<span class="hljs-number">0x1a</span>&gt;<br><br>000000000000293a &lt;phase_4&gt;:<br>    293a:	f3 0f 1e fa          	endbr64<br>    293e:	<span class="hljs-number">48</span> <span class="hljs-number">83</span> ec <span class="hljs-number">18</span>          	<span class="hljs-keyword">sub</span>    <span class="hljs-number">$0</span>x18,%rsp<br>    <span class="hljs-number">2942</span>:	<span class="hljs-number">64</span> <span class="hljs-number">48</span> 8b <span class="hljs-number">04</span> <span class="hljs-number">25</span> <span class="hljs-number">28</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">mov</span>    %fs:<span class="hljs-number">0x28</span>,%rax<br>    <span class="hljs-number">2949</span>:	<span class="hljs-number">00</span> <span class="hljs-number">00</span><br>    294b:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">08</span>       	<span class="hljs-keyword">mov</span>    %rax,<span class="hljs-number">0x8</span>(%rsp)<br>    <span class="hljs-number">2950</span>:	<span class="hljs-number">31</span> c0                	<span class="hljs-keyword">xor</span>    %eax,%eax<br>    <span class="hljs-number">2952</span>:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> 4c <span class="hljs-number">24</span> <span class="hljs-number">04</span>       	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x4</span>(%rsp),%rcx<br>    <span class="hljs-number">2957</span>:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> e2             	<span class="hljs-keyword">mov</span>    %rsp,%rdx<br>    295a:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">35</span> <span class="hljs-number">07</span> <span class="hljs-number">2d</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x2d07</span>(%rip),%rsi        # <span class="hljs-number">5668</span> &lt;array<span class="hljs-number">.0</span>+<span class="hljs-number">0x328</span>&gt;<br>    <span class="hljs-number">2961</span>:	e8 fa f9 ff ff       	<span class="hljs-keyword">call</span>   <span class="hljs-number">2360</span> &lt;__isoc99_sscanf@plt&gt;<br>    <span class="hljs-number">2966</span>:	<span class="hljs-number">83</span> f8 <span class="hljs-number">02</span>             	<span class="hljs-keyword">cmp</span>    <span class="hljs-number">$0</span>x2,%eax<br>    <span class="hljs-number">2969</span>:	<span class="hljs-number">75</span> 0c                	<span class="hljs-keyword">jne</span>    <span class="hljs-number">2977</span> &lt;phase_4+<span class="hljs-number">0x3d</span>&gt;<br>    296b:	8b <span class="hljs-number">04</span> <span class="hljs-number">24</span>             	<span class="hljs-keyword">mov</span>    (%rsp),%eax<br>    296e:	<span class="hljs-number">85</span> c0                	<span class="hljs-keyword">test</span>   %eax,%eax<br>    <span class="hljs-number">2970</span>:	<span class="hljs-number">78</span> <span class="hljs-number">05</span>                	<span class="hljs-keyword">js</span>     <span class="hljs-number">2977</span> &lt;phase_4+<span class="hljs-number">0x3d</span>&gt;<br>    <span class="hljs-number">2972</span>:	<span class="hljs-number">83</span> f8 0e             	<span class="hljs-keyword">cmp</span>    <span class="hljs-number">$0</span>xe,%eax<br>    <span class="hljs-number">2975</span>:	7e <span class="hljs-number">05</span>                	<span class="hljs-keyword">jle</span>    297c &lt;phase_4+<span class="hljs-number">0x42</span>&gt;<br>    <span class="hljs-number">2977</span>:	e8 <span class="hljs-number">67</span> <span class="hljs-number">06</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br>    297c:	ba 0e <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>xe,%edx<br>    <span class="hljs-number">2981</span>:	be <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x0,%esi<br>    <span class="hljs-number">2986</span>:	8b 3c <span class="hljs-number">24</span>             	<span class="hljs-keyword">mov</span>    (%rsp),%edi<br>    <span class="hljs-number">2989</span>:	e8 <span class="hljs-number">76</span> ff ff ff       	<span class="hljs-keyword">call</span>   <span class="hljs-number">2904</span> &lt;func4&gt;<br>    298e:	<span class="hljs-number">83</span> f8 <span class="hljs-number">0b</span>             	<span class="hljs-keyword">cmp</span>    <span class="hljs-number">$0</span>xb,%eax<br>    <span class="hljs-number">2991</span>:	<span class="hljs-number">75</span> <span class="hljs-number">07</span>                	<span class="hljs-keyword">jne</span>    299a &lt;phase_4+<span class="hljs-number">0x60</span>&gt;<br>    <span class="hljs-number">2993</span>:	<span class="hljs-number">83</span> 7c <span class="hljs-number">24</span> <span class="hljs-number">04</span> <span class="hljs-number">0b</span>       	cmpl   <span class="hljs-number">$0</span>xb,<span class="hljs-number">0x4</span>(%rsp)<br>    <span class="hljs-number">2998</span>:	<span class="hljs-number">74</span> <span class="hljs-number">05</span>                	<span class="hljs-keyword">je</span>     299f &lt;phase_4+<span class="hljs-number">0x65</span>&gt;<br>    299a:	e8 <span class="hljs-number">44</span> <span class="hljs-number">06</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br>    299f:	<span class="hljs-number">48</span> 8b <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">08</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">0x8</span>(%rsp),%rax<br>    29a4:	<span class="hljs-number">64</span> <span class="hljs-number">48</span> 2b <span class="hljs-number">04</span> <span class="hljs-number">25</span> <span class="hljs-number">28</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">sub</span>    %fs:<span class="hljs-number">0x28</span>,%rax<br>    29ab:	<span class="hljs-number">00</span> <span class="hljs-number">00</span><br>    29ad:	<span class="hljs-number">75</span> <span class="hljs-number">05</span>                	<span class="hljs-keyword">jne</span>    29b4 &lt;phase_4+<span class="hljs-number">0x7a</span>&gt;<br>    29af:	<span class="hljs-number">48</span> <span class="hljs-number">83</span> c4 <span class="hljs-number">18</span>          	<span class="hljs-keyword">add</span>    <span class="hljs-number">$0</span>x18,%rsp<br>    29b3:	c3                   	<span class="hljs-keyword">ret</span><br>    29b4:	e8 f7 f8 ff ff       	<span class="hljs-keyword">call</span>   22b0 &lt;__stack_chk_fail@plt&gt;<br></code></pre></td></tr></table></figure>

<p>首先，我们注意到了熟悉的函数调用 <code>__isoc99_sscanf@plt</code>，同样地，我们可以在调用前查看相关寄存器的值来推测输入格式，发现为输入是两个整数。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">000000000000293a &lt;phase_4&gt;:<br>    <span class="hljs-comment">; ...</span><br>    <span class="hljs-number">2966</span>:	<span class="hljs-number">83</span> f8 <span class="hljs-number">02</span>             	<span class="hljs-keyword">cmp</span>    <span class="hljs-number">$0</span>x2,%eax<br>    <span class="hljs-number">2969</span>:	<span class="hljs-number">75</span> 0c                	<span class="hljs-keyword">jne</span>    <span class="hljs-number">2977</span> &lt;phase_4+<span class="hljs-number">0x3d</span>&gt;  <span class="hljs-comment">; if (num_inputs != 2) explode_bomb()</span><br>    296b:	8b <span class="hljs-number">04</span> <span class="hljs-number">24</span>             	<span class="hljs-keyword">mov</span>    (%rsp),%eax  <span class="hljs-comment">; eax = input[0]</span><br>    296e:	<span class="hljs-number">85</span> c0                	<span class="hljs-keyword">test</span>   %eax,%eax<br>    <span class="hljs-number">2970</span>:	<span class="hljs-number">78</span> <span class="hljs-number">05</span>                	<span class="hljs-keyword">js</span>     <span class="hljs-number">2977</span> &lt;phase_4+<span class="hljs-number">0x3d</span>&gt;  <span class="hljs-comment">; if (eax &lt; 0) explode_bomb()</span><br>    <span class="hljs-number">2972</span>:	<span class="hljs-number">83</span> f8 0e             	<span class="hljs-keyword">cmp</span>    <span class="hljs-number">$0</span>xe,%eax<br>    <span class="hljs-number">2975</span>:	7e <span class="hljs-number">05</span>                	<span class="hljs-keyword">jle</span>    297c &lt;phase_4+<span class="hljs-number">0x42</span>&gt;  <span class="hljs-comment">; if (eax &gt; 14) explode_bomb()</span><br>    <span class="hljs-number">2977</span>:	e8 <span class="hljs-number">67</span> <span class="hljs-number">06</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br>    297c:	ba 0e <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>xe,%edx  <span class="hljs-comment">; edx = 14</span><br>    <span class="hljs-number">2981</span>:	be <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x0,%esi  <span class="hljs-comment">; esi = 0</span><br>    <span class="hljs-number">2986</span>:	8b 3c <span class="hljs-number">24</span>             	<span class="hljs-keyword">mov</span>    (%rsp),%edi  <span class="hljs-comment">; edi = input[0]</span><br>    <span class="hljs-number">2989</span>:	e8 <span class="hljs-number">76</span> ff ff ff       	<span class="hljs-keyword">call</span>   <span class="hljs-number">2904</span> &lt;func4&gt;  <span class="hljs-comment">; eax = func4(edi, esi, edx)</span><br>    298e:	<span class="hljs-number">83</span> f8 <span class="hljs-number">0b</span>             	<span class="hljs-keyword">cmp</span>    <span class="hljs-number">$0</span>xb,%eax  <span class="hljs-comment">; if (eax != 11) explode_bomb()</span><br>    <span class="hljs-number">2991</span>:	<span class="hljs-number">75</span> <span class="hljs-number">07</span>                	<span class="hljs-keyword">jne</span>    299a &lt;phase_4+<span class="hljs-number">0x60</span>&gt;<br>    <span class="hljs-number">2993</span>:	<span class="hljs-number">83</span> 7c <span class="hljs-number">24</span> <span class="hljs-number">04</span> <span class="hljs-number">0b</span>       	cmpl   <span class="hljs-number">$0</span>xb,<span class="hljs-number">0x4</span>(%rsp)  <span class="hljs-comment">; if (input[1] != 11) explode_bomb()</span><br>    <span class="hljs-number">2998</span>:	<span class="hljs-number">74</span> <span class="hljs-number">05</span>                	<span class="hljs-keyword">je</span>     299f &lt;phase_4+<span class="hljs-number">0x65</span>&gt;<br>    299a:	e8 <span class="hljs-number">44</span> <span class="hljs-number">06</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br>    <span class="hljs-comment">; ...</span><br></code></pre></td></tr></table></figure>

<p>分析发现，phase 4 对输入的要求如下：</p>
<ol>
<li>输入的第一个整数必须在 0 到 14 之间</li>
<li>计算 <code>func4(input[0], 0, 14)</code> 的结果必须为 11</li>
<li>输入的第二个整数必须为 11</li>
</ol>
<p>接着使用伟大的枚举法，枚举 <code>input[0]</code> 从 1 到 13 的值，得到 phase 4 的答案为：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">0 11<br></code></pre></td></tr></table></figure>

<h1 id="Phase-5"><a href="#Phase-5" class="headerlink" title="Phase 5"></a>Phase 5</h1><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">00000000000029b9 &lt;phase_5&gt;:<br>    29b9:	f3 0f 1e fa          	endbr64<br>    29bd:	<span class="hljs-number">53</span>                   	<span class="hljs-keyword">push</span>   %rbx<br>    29be:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> fb             	<span class="hljs-keyword">mov</span>    %rdi,%rbx<br>    29c1:	e8 f0 <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2cb6 &lt;string_length&gt;<br>    29c6:	<span class="hljs-number">83</span> f8 <span class="hljs-number">04</span>             	<span class="hljs-keyword">cmp</span>    <span class="hljs-number">$0</span>x4,%eax<br>    29c9:	<span class="hljs-number">75</span> 0c                	<span class="hljs-keyword">jne</span>    29d7 &lt;phase_5+<span class="hljs-number">0x1e</span>&gt;<br>    29cb:	b9 <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x1,%ecx<br>    29d0:	b8 <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x0,%eax<br>    29d5:	eb 1f                	<span class="hljs-keyword">jmp</span>    29f6 &lt;phase_5+<span class="hljs-number">0x3d</span>&gt;<br>    29d7:	e8 <span class="hljs-number">07</span> <span class="hljs-number">06</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br>    29dc:	eb ed                	<span class="hljs-keyword">jmp</span>    29cb &lt;phase_5+<span class="hljs-number">0x12</span>&gt;<br>    29de:	<span class="hljs-number">48</span> <span class="hljs-number">63</span> d0             	movslq %eax,%rdx<br>    29e1:	0f b6 <span class="hljs-number">14</span> <span class="hljs-number">13</span>          	movzbl (%rbx,%rdx,<span class="hljs-number">1</span>),%edx<br>    29e5:	<span class="hljs-number">83</span> e2 <span class="hljs-number">07</span>             	<span class="hljs-keyword">and</span>    <span class="hljs-number">$0</span>x7,%edx<br>    29e8:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">35</span> <span class="hljs-number">51</span> <span class="hljs-number">29</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x2951</span>(%rip),%rsi        # <span class="hljs-number">5340</span> &lt;array<span class="hljs-number">.0</span>&gt;<br>    29ef:	0f af 0c <span class="hljs-number">96</span>          	<span class="hljs-keyword">imul</span>   (%rsi,%rdx,<span class="hljs-number">4</span>),%ecx<br>    29f3:	<span class="hljs-number">83</span> c0 <span class="hljs-number">01</span>             	<span class="hljs-keyword">add</span>    <span class="hljs-number">$0</span>x1,%eax<br>    29f6:	<span class="hljs-number">83</span> f8 <span class="hljs-number">03</span>             	<span class="hljs-keyword">cmp</span>    <span class="hljs-number">$0</span>x3,%eax<br>    29f9:	7e e3                	<span class="hljs-keyword">jle</span>    29de &lt;phase_5+<span class="hljs-number">0x25</span>&gt;<br>    29fb:	<span class="hljs-number">81</span> f9 c0 <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>    	<span class="hljs-keyword">cmp</span>    <span class="hljs-number">$0</span>xc0,%ecx<br>    2a01:	<span class="hljs-number">75</span> <span class="hljs-number">02</span>                	<span class="hljs-keyword">jne</span>    2a05 &lt;phase_5+<span class="hljs-number">0x4c</span>&gt;<br>    2a03:	5b                   	<span class="hljs-keyword">pop</span>    %rbx<br>    2a04:	c3                   	<span class="hljs-keyword">ret</span><br>    2a05:	e8 d9 <span class="hljs-number">05</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br>    2a0a:	eb f7                	<span class="hljs-keyword">jmp</span>    2a03 &lt;phase_5+<span class="hljs-number">0x4a</span>&gt;<br></code></pre></td></tr></table></figure>

<p>phase 5 开头调用了 <code>string_length</code>，猜测输入要求是一个字符串。经过简单调试可以发现，输入的字符串储存在 <code>[%rdi]</code> 处，之后该值由 <code>%rbx</code> 保存，<code>string_length</code> 的返回值 <code>%rax</code> 代表字符串的长度。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">00000000000029b9 &lt;phase_5&gt;:<br>    <span class="hljs-comment">; ...</span><br>    29bd:	<span class="hljs-number">53</span>                   	<span class="hljs-keyword">push</span>   %rbx<br>    29be:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> fb             	<span class="hljs-keyword">mov</span>    %rdi,%rbx <span class="hljs-comment">; *rbx = inputs</span><br>    29c1:	e8 f0 <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2cb6 &lt;string_length&gt;<br>    29c6:	<span class="hljs-number">83</span> f8 <span class="hljs-number">04</span>             	<span class="hljs-keyword">cmp</span>    <span class="hljs-number">$0</span>x4,%eax<br>    29c9:	<span class="hljs-number">75</span> 0c                	<span class="hljs-keyword">jne</span>    29d7 &lt;phase_5+<span class="hljs-number">0x1e</span>&gt;  <span class="hljs-comment">; if (length != 4) explode_bomb()</span><br>    29cb:	b9 <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x1,%ecx  <span class="hljs-comment">; ecx = 1</span><br>    29d0:	b8 <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x0,%eax  <span class="hljs-comment">; eax = 0</span><br>    29d5:	eb 1f                	<span class="hljs-keyword">jmp</span>    29f6 &lt;phase_5+<span class="hljs-number">0x3d</span>&gt;<br>    29d7:	e8 <span class="hljs-number">07</span> <span class="hljs-number">06</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br>    29dc:	eb ed                	<span class="hljs-keyword">jmp</span>    29cb &lt;phase_5+<span class="hljs-number">0x12</span>&gt;<br>    29de:	<span class="hljs-number">48</span> <span class="hljs-number">63</span> d0             	movslq %eax,%rdx  <span class="hljs-comment">; loop rdx = eax</span><br>    29e1:	0f b6 <span class="hljs-number">14</span> <span class="hljs-number">13</span>          	movzbl (%rbx,%rdx,<span class="hljs-number">1</span>),%edx  <span class="hljs-comment">; edx = inputs[rdx]</span><br>    29e5:	<span class="hljs-number">83</span> e2 <span class="hljs-number">07</span>             	<span class="hljs-keyword">and</span>    <span class="hljs-number">$0</span>x7,%edx  <span class="hljs-comment">; edx = edx &amp; 0x7</span><br>    29e8:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">35</span> <span class="hljs-number">51</span> <span class="hljs-number">29</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x2951</span>(%rip),%rsi        # <span class="hljs-number">5340</span> &lt;array<span class="hljs-number">.0</span>&gt;<br>    29ef:	0f af 0c <span class="hljs-number">96</span>          	<span class="hljs-keyword">imul</span>   (%rsi,%rdx,<span class="hljs-number">4</span>),%ecx  <span class="hljs-comment">; ecx = ecx * array[edx]</span><br>    29f3:	<span class="hljs-number">83</span> c0 <span class="hljs-number">01</span>             	<span class="hljs-keyword">add</span>    <span class="hljs-number">$0</span>x1,%eax  <span class="hljs-comment">; eax++</span><br>    29f6:	<span class="hljs-number">83</span> f8 <span class="hljs-number">03</span>             	<span class="hljs-keyword">cmp</span>    <span class="hljs-number">$0</span>x3,%eax<br>    29f9:	7e e3                	<span class="hljs-keyword">jle</span>    29de &lt;phase_5+<span class="hljs-number">0x25</span>&gt;  <span class="hljs-comment">; loop while (eax &lt;= 3)</span><br>    29fb:	<span class="hljs-number">81</span> f9 c0 <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>    	<span class="hljs-keyword">cmp</span>    <span class="hljs-number">$0</span>xc0,%ecx<br>    2a01:	<span class="hljs-number">75</span> <span class="hljs-number">02</span>                	<span class="hljs-keyword">jne</span>    2a05 &lt;phase_5+<span class="hljs-number">0x4c</span>&gt;  <span class="hljs-comment">; if (ecx != 0xc0) explode_bomb()</span><br>    2a03:	5b                   	<span class="hljs-keyword">pop</span>    %rbx<br>    2a04:	c3                   	<span class="hljs-keyword">ret</span><br>    2a05:	e8 d9 <span class="hljs-number">05</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br>    2a0a:	eb f7                	<span class="hljs-keyword">jmp</span>    2a03 &lt;phase_5+<span class="hljs-number">0x4a</span>&gt;<br></code></pre></td></tr></table></figure>

<p>梳理一下程序逻辑：</p>
<ol>
<li>输入的字符串长度必须为 4</li>
<li>初始化 <code>ecx = 1</code>，<code>eax = 0</code></li>
<li>对字符串的每个字符（共 4 个），执行以下操作：<ol>
<li>取字符的 ASCII 码与 0x7 做与运算，结果作为索引从数组 <code>array.0</code> 中取值</li>
<li>将取出的值乘到 <code>ecx</code> 上</li>
<li><code>eax</code> 自增 1</li>
</ol>
</li>
<li>最终 <code>ecx</code> 必须等于 0xc0（即 192）<br>根据上述逻辑，接下来我们需要查看 <code>array.0</code> 的内容。让程序运行到 <code>29ef</code> 处，此时 <code>array.0</code> 的地址被储存在 <code>%rsi</code> 中，调用 <code>x/10wd $rsi</code> 以四字节为单位查看数组的前十个元素的十进制值。</li>
</ol>
<p><img src="/img/ics-bomblab/phase-5.png" srcset="/img/loading.gif" lazyload></p>
<p>可见 <code>array.0</code> 由 8 个 int 类整数构成，接下来的事情就简单了，我们只需用数组中的数凑出乘积为 192 的一种组合，倒推出满足条件的四个字符即可。经过计算，phase 5 的答案之一为：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">hadd<br></code></pre></td></tr></table></figure>

<h1 id="Phase-6"><a href="#Phase-6" class="headerlink" title="Phase 6"></a>Phase 6</h1><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">0000000000002a0c &lt;phase_6&gt;:<br>    2a0c:	f3 0f 1e fa          	endbr64<br>    2a10:	<span class="hljs-number">41</span> <span class="hljs-number">54</span>                	<span class="hljs-keyword">push</span>   %r12<br>    2a12:	<span class="hljs-number">55</span>                   	<span class="hljs-keyword">push</span>   %rbp<br>    2a13:	<span class="hljs-number">53</span>                   	<span class="hljs-keyword">push</span>   %rbx<br>    2a14:	<span class="hljs-number">48</span> <span class="hljs-number">83</span> ec <span class="hljs-number">60</span>          	<span class="hljs-keyword">sub</span>    <span class="hljs-number">$0</span>x60,%rsp<br>    2a18:	<span class="hljs-number">64</span> <span class="hljs-number">48</span> 8b <span class="hljs-number">04</span> <span class="hljs-number">25</span> <span class="hljs-number">28</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">mov</span>    %fs:<span class="hljs-number">0x28</span>,%rax<br>    2a1f:	<span class="hljs-number">00</span> <span class="hljs-number">00</span><br>    2a21:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">58</span>       	<span class="hljs-keyword">mov</span>    %rax,<span class="hljs-number">0x58</span>(%rsp)<br>    2a26:	<span class="hljs-number">31</span> c0                	<span class="hljs-keyword">xor</span>    %eax,%eax<br>    2a28:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> e6             	<span class="hljs-keyword">mov</span>    %rsp,%rsi<br>    2a2b:	e8 <span class="hljs-number">39</span> <span class="hljs-number">06</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   <span class="hljs-number">3069</span> &lt;read_six_numbers&gt;<br>    2a30:	bd <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x0,%ebp<br>    2a35:	eb <span class="hljs-number">27</span>                	<span class="hljs-keyword">jmp</span>    2a5e &lt;phase_6+<span class="hljs-number">0x52</span>&gt;<br>    2a37:	e8 a7 <span class="hljs-number">05</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br>    2a3c:	eb <span class="hljs-number">33</span>                	<span class="hljs-keyword">jmp</span>    2a71 &lt;phase_6+<span class="hljs-number">0x65</span>&gt;<br>    2a3e:	<span class="hljs-number">83</span> c3 <span class="hljs-number">01</span>             	<span class="hljs-keyword">add</span>    <span class="hljs-number">$0</span>x1,%ebx<br>    2a41:	<span class="hljs-number">83</span> fb <span class="hljs-number">05</span>             	<span class="hljs-keyword">cmp</span>    <span class="hljs-number">$0</span>x5,%ebx<br>    2a44:	7f <span class="hljs-number">15</span>                	<span class="hljs-keyword">jg</span>     2a5b &lt;phase_6+<span class="hljs-number">0x4f</span>&gt;<br>    2a46:	<span class="hljs-number">48</span> <span class="hljs-number">63</span> c5             	movslq %ebp,%rax<br>    2a49:	<span class="hljs-number">48</span> <span class="hljs-number">63</span> d3             	movslq %ebx,%rdx<br>    2a4c:	8b 3c <span class="hljs-number">94</span>             	<span class="hljs-keyword">mov</span>    (%rsp,%rdx,<span class="hljs-number">4</span>),%edi<br>    2a4f:	<span class="hljs-number">39</span> 3c <span class="hljs-number">84</span>             	<span class="hljs-keyword">cmp</span>    %edi,(%rsp,%rax,<span class="hljs-number">4</span>)<br>    2a52:	<span class="hljs-number">75</span> ea                	<span class="hljs-keyword">jne</span>    2a3e &lt;phase_6+<span class="hljs-number">0x32</span>&gt;<br>    2a54:	e8 8a <span class="hljs-number">05</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br>    2a59:	eb e3                	<span class="hljs-keyword">jmp</span>    2a3e &lt;phase_6+<span class="hljs-number">0x32</span>&gt;<br>    2a5b:	<span class="hljs-number">44</span> <span class="hljs-number">89</span> e5             	<span class="hljs-keyword">mov</span>    %r12d,%ebp<br>    2a5e:	<span class="hljs-number">83</span> fd <span class="hljs-number">05</span>             	<span class="hljs-keyword">cmp</span>    <span class="hljs-number">$0</span>x5,%ebp<br>    2a61:	7f <span class="hljs-number">17</span>                	<span class="hljs-keyword">jg</span>     2a7a &lt;phase_6+<span class="hljs-number">0x6e</span>&gt;<br>    2a63:	<span class="hljs-number">48</span> <span class="hljs-number">63</span> c5             	movslq %ebp,%rax<br>    2a66:	8b <span class="hljs-number">04</span> <span class="hljs-number">84</span>             	<span class="hljs-keyword">mov</span>    (%rsp,%rax,<span class="hljs-number">4</span>),%eax<br>    2a69:	<span class="hljs-number">83</span> e8 <span class="hljs-number">01</span>             	<span class="hljs-keyword">sub</span>    <span class="hljs-number">$0</span>x1,%eax<br>    2a6c:	<span class="hljs-number">83</span> f8 <span class="hljs-number">05</span>             	<span class="hljs-keyword">cmp</span>    <span class="hljs-number">$0</span>x5,%eax<br>    2a6f:	<span class="hljs-number">77</span> c6                	<span class="hljs-keyword">ja</span>     2a37 &lt;phase_6+<span class="hljs-number">0x2b</span>&gt;<br>    2a71:	<span class="hljs-number">44</span> <span class="hljs-number">8d</span> <span class="hljs-number">65</span> <span class="hljs-number">01</span>          	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x1</span>(%rbp),%r12d<br>    2a75:	<span class="hljs-number">44</span> <span class="hljs-number">89</span> e3             	<span class="hljs-keyword">mov</span>    %r12d,%ebx<br>    2a78:	eb c7                	<span class="hljs-keyword">jmp</span>    2a41 &lt;phase_6+<span class="hljs-number">0x35</span>&gt;<br>    2a7a:	b8 <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x0,%eax<br>    2a7f:	eb <span class="hljs-number">11</span>                	<span class="hljs-keyword">jmp</span>    2a92 &lt;phase_6+<span class="hljs-number">0x86</span>&gt;<br>    2a81:	<span class="hljs-number">48</span> <span class="hljs-number">63</span> c8             	movslq %eax,%rcx<br>    2a84:	ba <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x7,%edx<br>    2a89:	2b <span class="hljs-number">14</span> 8c             	<span class="hljs-keyword">sub</span>    (%rsp,%rcx,<span class="hljs-number">4</span>),%edx<br>    2a8c:	<span class="hljs-number">89</span> <span class="hljs-number">14</span> 8c             	<span class="hljs-keyword">mov</span>    %edx,(%rsp,%rcx,<span class="hljs-number">4</span>)<br>    2a8f:	<span class="hljs-number">83</span> c0 <span class="hljs-number">01</span>             	<span class="hljs-keyword">add</span>    <span class="hljs-number">$0</span>x1,%eax<br>    2a92:	<span class="hljs-number">83</span> f8 <span class="hljs-number">05</span>             	<span class="hljs-keyword">cmp</span>    <span class="hljs-number">$0</span>x5,%eax<br>    2a95:	7e ea                	<span class="hljs-keyword">jle</span>    2a81 &lt;phase_6+<span class="hljs-number">0x75</span>&gt;<br>    2a97:	be <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x0,%esi<br>    2a9c:	eb <span class="hljs-number">17</span>                	<span class="hljs-keyword">jmp</span>    2ab5 &lt;phase_6+<span class="hljs-number">0xa9</span>&gt;<br>    2a9e:	<span class="hljs-number">48</span> 8b <span class="hljs-number">52</span> <span class="hljs-number">08</span>          	<span class="hljs-keyword">mov</span>    <span class="hljs-number">0x8</span>(%rdx),%rdx<br>    2aa2:	<span class="hljs-number">83</span> c0 <span class="hljs-number">01</span>             	<span class="hljs-keyword">add</span>    <span class="hljs-number">$0</span>x1,%eax<br>    2aa5:	<span class="hljs-number">48</span> <span class="hljs-number">63</span> ce             	movslq %esi,%rcx<br>    2aa8:	<span class="hljs-number">39</span> <span class="hljs-number">04</span> 8c             	<span class="hljs-keyword">cmp</span>    %eax,(%rsp,%rcx,<span class="hljs-number">4</span>)<br>    2aab:	7f f1                	<span class="hljs-keyword">jg</span>     2a9e &lt;phase_6+<span class="hljs-number">0x92</span>&gt;<br>    2<span class="hljs-keyword">aad</span>:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> <span class="hljs-number">54</span> cc <span class="hljs-number">20</span>       	<span class="hljs-keyword">mov</span>    %rdx,<span class="hljs-number">0x20</span>(%rsp,%rcx,<span class="hljs-number">8</span>)<br>    2ab2:	<span class="hljs-number">83</span> c6 <span class="hljs-number">01</span>             	<span class="hljs-keyword">add</span>    <span class="hljs-number">$0</span>x1,%esi<br>    2ab5:	<span class="hljs-number">83</span> fe <span class="hljs-number">05</span>             	<span class="hljs-keyword">cmp</span>    <span class="hljs-number">$0</span>x5,%esi<br>    2ab8:	7f 0e                	<span class="hljs-keyword">jg</span>     2ac8 &lt;phase_6+<span class="hljs-number">0xbc</span>&gt;<br>    2aba:	b8 <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x1,%eax<br>    2abf:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">15</span> 4a <span class="hljs-number">66</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x664a</span>(%rip),%rdx        # <span class="hljs-number">9110</span> &lt;node1&gt;<br>    2ac6:	eb <span class="hljs-built_in">dd</span>                	<span class="hljs-keyword">jmp</span>    2aa5 &lt;phase_6+<span class="hljs-number">0x99</span>&gt;<br>    2ac8:	<span class="hljs-number">48</span> 8b 5c <span class="hljs-number">24</span> <span class="hljs-number">20</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">0x20</span>(%rsp),%rbx<br>    2acd:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> d9             	<span class="hljs-keyword">mov</span>    %rbx,%rcx<br>    2ad0:	b8 <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x1,%eax<br>    2ad5:	eb <span class="hljs-number">12</span>                	<span class="hljs-keyword">jmp</span>    2ae9 &lt;phase_6+<span class="hljs-number">0xdd</span>&gt;<br>    2ad7:	<span class="hljs-number">48</span> <span class="hljs-number">63</span> d0             	movslq %eax,%rdx<br>    2ada:	<span class="hljs-number">48</span> 8b <span class="hljs-number">54</span> d4 <span class="hljs-number">20</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">0x20</span>(%rsp,%rdx,<span class="hljs-number">8</span>),%rdx<br>    2adf:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> <span class="hljs-number">51</span> <span class="hljs-number">08</span>          	<span class="hljs-keyword">mov</span>    %rdx,<span class="hljs-number">0x8</span>(%rcx)<br>    2ae3:	<span class="hljs-number">83</span> c0 <span class="hljs-number">01</span>             	<span class="hljs-keyword">add</span>    <span class="hljs-number">$0</span>x1,%eax<br>    2ae6:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> d1             	<span class="hljs-keyword">mov</span>    %rdx,%rcx<br>    2ae9:	<span class="hljs-number">83</span> f8 <span class="hljs-number">05</span>             	<span class="hljs-keyword">cmp</span>    <span class="hljs-number">$0</span>x5,%eax<br>    2aec:	7e e9                	<span class="hljs-keyword">jle</span>    2ad7 &lt;phase_6+<span class="hljs-number">0xcb</span>&gt;<br>    2aee:	<span class="hljs-number">48</span> c7 <span class="hljs-number">41</span> <span class="hljs-number">08</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">movq</span>   <span class="hljs-number">$0</span>x0,<span class="hljs-number">0x8</span>(%rcx)<br>    2af5:	<span class="hljs-number">00</span><br>    2af6:	bd <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x0,%ebp<br>    2afb:	eb <span class="hljs-number">07</span>                	<span class="hljs-keyword">jmp</span>    2b04 &lt;phase_6+<span class="hljs-number">0xf8</span>&gt;<br>    2afd:	<span class="hljs-number">48</span> 8b 5b <span class="hljs-number">08</span>          	<span class="hljs-keyword">mov</span>    <span class="hljs-number">0x8</span>(%rbx),%rbx<br>    2b01:	<span class="hljs-number">83</span> c5 <span class="hljs-number">01</span>             	<span class="hljs-keyword">add</span>    <span class="hljs-number">$0</span>x1,%ebp<br>    2b04:	<span class="hljs-number">83</span> fd <span class="hljs-number">04</span>             	<span class="hljs-keyword">cmp</span>    <span class="hljs-number">$0</span>x4,%ebp<br>    2b07:	7f <span class="hljs-number">11</span>                	<span class="hljs-keyword">jg</span>     2b1a &lt;phase_6+<span class="hljs-number">0x10e</span>&gt;<br>    2b09:	<span class="hljs-number">48</span> 8b <span class="hljs-number">43</span> <span class="hljs-number">08</span>          	<span class="hljs-keyword">mov</span>    <span class="hljs-number">0x8</span>(%rbx),%rax<br>    2b0d:	8b <span class="hljs-number">00</span>                	<span class="hljs-keyword">mov</span>    (%rax),%eax<br>    2b0f:	<span class="hljs-number">39</span> <span class="hljs-number">03</span>                	<span class="hljs-keyword">cmp</span>    %eax,(%rbx)<br>    2b11:	7e ea                	<span class="hljs-keyword">jle</span>    2afd &lt;phase_6+<span class="hljs-number">0xf1</span>&gt;<br>    2b13:	e8 cb <span class="hljs-number">04</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br>    2b18:	eb e3                	<span class="hljs-keyword">jmp</span>    2afd &lt;phase_6+<span class="hljs-number">0xf1</span>&gt;<br>    2b1a:	<span class="hljs-number">48</span> 8b <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">58</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">0x58</span>(%rsp),%rax<br>    2b1f:	<span class="hljs-number">64</span> <span class="hljs-number">48</span> 2b <span class="hljs-number">04</span> <span class="hljs-number">25</span> <span class="hljs-number">28</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">sub</span>    %fs:<span class="hljs-number">0x28</span>,%rax<br>    2b26:	<span class="hljs-number">00</span> <span class="hljs-number">00</span><br>    2b28:	<span class="hljs-number">75</span> <span class="hljs-number">09</span>                	<span class="hljs-keyword">jne</span>    2b33 &lt;phase_6+<span class="hljs-number">0x127</span>&gt;<br>    2b2a:	<span class="hljs-number">48</span> <span class="hljs-number">83</span> c4 <span class="hljs-number">60</span>          	<span class="hljs-keyword">add</span>    <span class="hljs-number">$0</span>x60,%rsp<br>    2b2e:	5b                   	<span class="hljs-keyword">pop</span>    %rbx<br>    2b2f:	<span class="hljs-number">5d</span>                   	<span class="hljs-keyword">pop</span>    %rbp<br>    2b30:	<span class="hljs-number">41</span> 5c                	<span class="hljs-keyword">pop</span>    %r12<br>    2b32:	c3                   	<span class="hljs-keyword">ret</span><br>    2b33:	e8 <span class="hljs-number">78</span> f7 ff ff       	<span class="hljs-keyword">call</span>   22b0 &lt;__stack_chk_fail@plt&gt;<br></code></pre></td></tr></table></figure>

<p>相较于前几个 phase，phase 6 的代码量显著增加，分析难度也有所提升。首先我们注意到 <code>read_six_numbers</code> 函数的调用，猜测输入格式为六个整数，有了前几个 phase 的经验，六个整数应该依次储存在 <code>[%rsp]</code> 的位置（调试验证确实如此）。</p>
<p>由于汇编代码过长，一个可选的方案是对代码的主干部分进行人工反汇编，并将一些跳转逻辑转换成条件分支或循环，呈现为伪代码形式：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    rsi = rsp;<br>    rbp = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-comment">// 第一阶段：检查输入合法性（无重复且1-6）</span><br>    <span class="hljs-keyword">while</span> (rbp &lt;= <span class="hljs-number">5</span>) &#123;<br>        rax = rbp;<br>        rax = *(rsp + rax * <span class="hljs-number">4</span>);<br>        rax -= <span class="hljs-number">1</span>;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &lt;= rax &lt;= <span class="hljs-number">5</span>) &#123;  <span class="hljs-comment">// 注意 2ab8 处的 ja</span><br>            r12 = rbp + <span class="hljs-number">1</span>;<br>            rbx = r12;<br>            <span class="hljs-keyword">while</span> (rbx &lt;= <span class="hljs-number">5</span>) &#123;<br>                rax = rbp;<br>                rdx = rbx;<br>                rdi = *(rsp + rdx * <span class="hljs-number">4</span>);<br>                <span class="hljs-keyword">if</span> (*(rsp + rax * <span class="hljs-number">4</span>) == rdi) explode_bomb();<br>                rbx += <span class="hljs-number">1</span>;<br>            &#125;<br>            rbp = r12;<br>        &#125;<br>        <span class="hljs-keyword">else</span> explode_bomb();<br>    &#125;<br><br>    <span class="hljs-comment">// 第二阶段：转换输入值（7 - 原输入）</span><br>    rax = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (rax &lt;= <span class="hljs-number">5</span>) &#123;<br>        rcx = rax;<br>        rdx = <span class="hljs-number">7</span>;<br>        rdx -= *(rsp + rcx * <span class="hljs-number">4</span>);  <span class="hljs-comment">// 7 - 原输入值</span><br>        *(rsp + rcx * <span class="hljs-number">4</span>) = rdx;<br>        rax += <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 第三阶段：存储链表节点地址（基于转换后的值，第i个节点）</span><br>    rsi = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (rsi &lt;= <span class="hljs-number">5</span>) &#123;<br>        rax = <span class="hljs-number">1</span>;<br>        rdx = rip + <span class="hljs-number">0x664a</span>;  <span class="hljs-comment">// 调试时可查看，发现是链表节点的起始地址</span><br>        rcx = rsi;  <span class="hljs-comment">// index</span><br>        <span class="hljs-keyword">while</span> (*(rsp + rcx * <span class="hljs-number">4</span>) &gt; rax) &#123;<br>            rdx = *(rdx + <span class="hljs-number">0x8</span>);  <span class="hljs-comment">// 移动到下一个节点</span><br>            rax += <span class="hljs-number">1</span>;<br>            rcx = rsi;<br>        &#125;<br>        *(rsp + <span class="hljs-number">0x20</span> + rcx * <span class="hljs-number">8</span>) = rdx;  <span class="hljs-comment">// 存储节点地址</span><br>        rsi += <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 第四阶段：重新构建链表</span><br>    rbx = *(rsp + <span class="hljs-number">0x20</span>);  <span class="hljs-comment">// 第一个储存的节点地址</span><br>    rcx = rbx;<br>    rax = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">while</span> (rax &lt;= <span class="hljs-number">5</span>) &#123;<br>        rdx = rax;<br>        rdx = *(rsp + <span class="hljs-number">0x20</span> + rdx * <span class="hljs-number">8</span>);<br>        *(rcx + <span class="hljs-number">0x8</span>) = rdx;<br>        rax += <span class="hljs-number">1</span>;<br>        rcx = rdx;  <span class="hljs-comment">// 新节点地址</span><br>    &#125;<br><br>    <span class="hljs-comment">// 第五阶段：校验链表升序</span><br>    rbp = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (rbp &lt;= <span class="hljs-number">4</span>) &#123;<br>        rax = *(rbx + <span class="hljs-number">0x8</span>);  <span class="hljs-comment">// next 节点地址</span><br>        rax = *rax;  <span class="hljs-comment">// next 节点的值</span><br>        <span class="hljs-comment">// 比较当前节点值与 next 节点值</span><br>        <span class="hljs-keyword">if</span> (*rbx &gt; eax) &#123;  <span class="hljs-comment">// 注意 2b0f 处，四字节比较</span><br>            explode_bomb();<br>        &#125;<br>        rbx = *(rbx + <span class="hljs-number">0x8</span>);<br>        rbp += <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>为了能够理解代码逻辑，我们需要事先知道 <code>[%rip + 0x664a]</code> 处的内容（虽然由 node 可猜测为链表节点）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 在 lea 0x657b (%rip), %rdx 的下一行设置断点，从而查看更新后的 %rdx</span><br>b *(phase_6+186)<br>c<br>x/24wx <span class="hljs-variable">$rdx</span><br></code></pre></td></tr></table></figure>

<p>得到输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">(gdb)x/24wx <span class="hljs-variable">$rdx</span><br>0x55555555d110 &lt;node1&gt;: 0x0000004e  0x00000001  0x5555d120  0x00005555<br>0x55555555d120 &lt;node2&gt;: 0x000002e8  0x00000002  0x5555d130  0x00005555<br>0x55555555d130 &lt;node3&gt;: 0x0000033b  0x00000003  0x5555d140  0x00005555<br>0x55555555d140 &lt;node4&gt;: 0x000003bb  0x00000004  0x5555d150  0x00005555<br>0x55555555d150 &lt;node5&gt;: 0x00000283  0x00000005  0x5555c080  0x00005555<br>0x55555555d160 &lt;host_table&gt;: 0x555596b2 0x00005555 0x555596bb 0x00005555<br>(gdb)x/4wx 0x000055555555c080<br>0x55555555c080 &lt;node6&gt;: 0x00000326  0x00000006  0x00000000  0x00000000<br></code></pre></td></tr></table></figure>

<p>结合小端法和汇编代码，推测 node 的结构如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span> &#123;</span><br>    <span class="hljs-type">int</span> value;          <span class="hljs-comment">// 节点值</span><br>    <span class="hljs-type">int</span> index;          <span class="hljs-comment">// 节点索引</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span> *<span class="hljs-title">next</span>;</span>  <span class="hljs-comment">// 指向下一个节点的指针</span><br>&#125;;<br></code></pre></td></tr></table></figure>

<p>现在我们知道了 node 的值，结合代码逻辑，可以反推 phase 6 的答案了：</p>
<ol>
<li>将 node 按照值从小到大排序，得到顺序为：<code>node1</code> -&gt; <code>node5</code> -&gt; <code>node2</code> -&gt; <code>node6</code> -&gt; <code>node3</code> -&gt; <code>node4</code></li>
<li>取出对应的索引，得到索引顺序为：<code>1 5 2 6 3 4</code></li>
<li>进行 <code>7 - i</code> 操作，得到 phase 6 的答案为：</li>
</ol>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">6 2 5 1 4 3<br></code></pre></td></tr></table></figure>

<h1 id="Secret-Phase"><a href="#Secret-Phase" class="headerlink" title="Secret Phase"></a>Secret Phase</h1><p>如果仔细查看汇编代码 <code>phase_defused</code> 的部分，会发现其中有三个函数的调用：</p>
<ul>
<li><code>abracadabra</code></li>
<li><code>alohomora</code></li>
<li><code>secret_phase</code></li>
</ul>
<p>想要破解 secret phase，我们需要先从 <code>phase_defused</code> 入手。</p>
<h2 id="phase-defused"><a href="#phase-defused" class="headerlink" title="phase_defused"></a>phase_defused</h2><ol>
<li>函数起始，执行<code>endbr64</code>安全指令，随后将<code>%rbx</code>寄存器入栈保存</li>
<li>将第一个参数（<code>%rdi</code>）的值存入<code>%rbx</code>寄存器，保存该参数指针</li>
<li>向<code>%rdi</code>指向的内存地址写入<code>0x0</code>（初始化该地址的值为 0）</li>
<li>设置参数：将<code>%rdi</code>的值赋给<code>%rsi</code>（第二个参数），将<code>0x1</code>赋给<code>%edi</code>（第一个参数），调用<code>send_msg</code>函数发送消息</li>
</ol>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">00000000000031ec &lt;phase_defused&gt;:<br>    31ec:	f3 0f 1e fa          	endbr64<br>    31f0:	<span class="hljs-number">53</span>                   	<span class="hljs-keyword">push</span>   %rbx<br>    31f1:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> fb             	<span class="hljs-keyword">mov</span>    %rdi,%rbx<br>    31f4:	c7 <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>    	movl   <span class="hljs-number">$0</span>x0,(%rdi)<br>    31fa:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> fe             	<span class="hljs-keyword">mov</span>    %rdi,%rsi<br>    31fd:	bf <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x1,%edi<br>    <span class="hljs-number">3202</span>:	e8 7a fc ff ff       	<span class="hljs-keyword">call</span>   2e81 &lt;send_msg&gt;<br>    <span class="hljs-comment">; ...</span><br></code></pre></td></tr></table></figure>

<ol start="5">
<li>检查<code>%rbx</code>指向的内存地址的值是否等于<code>0x1</code>：<ul>
<li>若不等于（<code>jne</code>），跳转到步骤 6</li>
<li>若等于，继续步骤 7</li>
</ul>
</li>
<li>打印一些字符串，并调用<code>exit</code>函数退出程序</li>
<li>检查<code>num_input_strings</code>（内存地址<code>0x63c5(%rip)</code>）的值是否等于<code>0x6</code>：<ul>
<li>若不等于，执行<code>pop %rbx</code>和<code>ret</code>指令，函数返回</li>
<li>若等于（<code>je</code>），跳转到步骤 8</li>
</ul>
</li>
</ol>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">00000000000031ec &lt;phase_defused&gt;:<br>    <span class="hljs-comment">; ...</span><br>    <span class="hljs-number">3207</span>:	<span class="hljs-number">83</span> 3b <span class="hljs-number">01</span>             	cmpl   <span class="hljs-number">$0</span>x1,(%rbx)<br>    320a:	<span class="hljs-number">75</span> <span class="hljs-number">0b</span>                	<span class="hljs-keyword">jne</span>    <span class="hljs-number">3217</span> &lt;phase_defused+<span class="hljs-number">0x2b</span>&gt;<br>    320c:	<span class="hljs-number">83</span> <span class="hljs-number">3d</span> c5 <span class="hljs-number">63</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">06</span> 	cmpl   <span class="hljs-number">$0</span>x6,<span class="hljs-number">0x63c5</span>(%rip)        # 95d8 &lt;num_input_strings&gt;<br>    <span class="hljs-number">3213</span>:	<span class="hljs-number">74</span> <span class="hljs-number">22</span>                	<span class="hljs-keyword">je</span>     <span class="hljs-number">3237</span> &lt;phase_defused+<span class="hljs-number">0x4b</span>&gt;<br>    <span class="hljs-number">3215</span>:	5b                   	<span class="hljs-keyword">pop</span>    %rbx<br>    <span class="hljs-number">3216</span>:	c3                   	<span class="hljs-keyword">ret</span><br>    <span class="hljs-number">3217</span>:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">35</span> da <span class="hljs-number">21</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x21da</span>(%rip),%rsi        # 53f8 &lt;array<span class="hljs-number">.0</span>+<span class="hljs-number">0xb8</span>&gt;<br>    321e:	bf <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x1,%edi<br>    <span class="hljs-number">3223</span>:	b8 <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x0,%eax<br>    <span class="hljs-number">3228</span>:	e8 <span class="hljs-number">53</span> f1 ff ff       	<span class="hljs-keyword">call</span>   <span class="hljs-number">2380</span> &lt;__printf_chk@plt&gt;<br>    <span class="hljs-number">322d</span>:	bf <span class="hljs-number">08</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x8,%edi<br>    <span class="hljs-number">3232</span>:	e8 <span class="hljs-number">79</span> f1 ff ff       	<span class="hljs-keyword">call</span>   23b0 &lt;exit@plt&gt;<br>    <span class="hljs-comment">; ...</span><br></code></pre></td></tr></table></figure>

<ol start="8">
<li>调用<code>abracadabra</code>函数，检查其返回值（<code>%eax</code>）：<ul>
<li>若返回值为 0，打印一些字符串，随后跳转到步骤 7 中”不等于时”的返回逻辑</li>
<li>若返回值不为 0（<code>jne</code>），跳转到步骤 9</li>
</ul>
</li>
<li>调用<code>alohomora</code>函数，检查其返回值（<code>%eax</code>）：<ul>
<li>若返回值为 0（<code>je</code>），跳转到步骤 10</li>
<li>若返回值不为 0，打印一些字符串，随后调用<code>secret_phase</code>函数，再跳转到步骤 8 中”返回值为 0 时”的逻辑</li>
</ul>
</li>
<li>打印一些字符串，随后跳转到步骤 8 中”返回值为 0 时”的打印逻辑</li>
</ol>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">00000000000031ec &lt;phase_defused&gt;:<br>    <span class="hljs-comment">; ...</span><br>    <span class="hljs-number">3237</span>:	e8 <span class="hljs-number">48</span> f4 ff ff       	<span class="hljs-keyword">call</span>   <span class="hljs-number">2684</span> &lt;abracadabra&gt;<br>    323c:	<span class="hljs-number">85</span> c0                	<span class="hljs-keyword">test</span>   %eax,%eax<br>    323e:	<span class="hljs-number">75</span> 1a                	<span class="hljs-keyword">jne</span>    325a &lt;phase_defused+<span class="hljs-number">0x6e</span>&gt;<br>    <span class="hljs-number">3240</span>:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">3d</span> <span class="hljs-number">11</span> <span class="hljs-number">23</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x2311</span>(%rip),%rdi        # <span class="hljs-number">5558</span> &lt;array<span class="hljs-number">.0</span>+<span class="hljs-number">0x218</span>&gt;<br>    <span class="hljs-number">3247</span>:	e8 <span class="hljs-number">34</span> f0 ff ff       	<span class="hljs-keyword">call</span>   <span class="hljs-number">2280</span> &lt;puts@plt&gt;<br>    324c:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">3d</span> <span class="hljs-number">4d</span> <span class="hljs-number">23</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x234d</span>(%rip),%rdi        # 55a0 &lt;array<span class="hljs-number">.0</span>+<span class="hljs-number">0x260</span>&gt;<br>    <span class="hljs-number">3253</span>:	e8 <span class="hljs-number">28</span> f0 ff ff       	<span class="hljs-keyword">call</span>   <span class="hljs-number">2280</span> &lt;puts@plt&gt;<br>    <span class="hljs-number">3258</span>:	eb bb                	<span class="hljs-keyword">jmp</span>    <span class="hljs-number">3215</span> &lt;phase_defused+<span class="hljs-number">0x29</span>&gt;<br>    325a:	e8 b2 f4 ff ff       	<span class="hljs-keyword">call</span>   <span class="hljs-number">2711</span> &lt;alohomora&gt;<br>    325f:	<span class="hljs-number">85</span> c0                	<span class="hljs-keyword">test</span>   %eax,%eax<br>    <span class="hljs-number">3261</span>:	<span class="hljs-number">74</span> <span class="hljs-number">30</span>                	<span class="hljs-keyword">je</span>     <span class="hljs-number">3293</span> &lt;phase_defused+<span class="hljs-number">0xa7</span>&gt;<br>    <span class="hljs-number">3263</span>:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">3d</span> fe <span class="hljs-number">21</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x21fe</span>(%rip),%rdi        # <span class="hljs-number">5468</span> &lt;array<span class="hljs-number">.0</span>+<span class="hljs-number">0x128</span>&gt;<br>    326a:	e8 <span class="hljs-number">11</span> f0 ff ff       	<span class="hljs-keyword">call</span>   <span class="hljs-number">2280</span> &lt;puts@plt&gt;<br>    326f:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">3d</span> 1a <span class="hljs-number">22</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x221a</span>(%rip),%rdi        # <span class="hljs-number">5490</span> &lt;array<span class="hljs-number">.0</span>+<span class="hljs-number">0x150</span>&gt;<br>    <span class="hljs-number">3276</span>:	e8 <span class="hljs-number">05</span> f0 ff ff       	<span class="hljs-keyword">call</span>   <span class="hljs-number">2280</span> &lt;puts@plt&gt;<br>    327b:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">3d</span> <span class="hljs-number">46</span> <span class="hljs-number">22</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x2246</span>(%rip),%rdi        # 54c8 &lt;array<span class="hljs-number">.0</span>+<span class="hljs-number">0x188</span>&gt;<br>    <span class="hljs-number">3282</span>:	e8 f9 ef ff ff       	<span class="hljs-keyword">call</span>   <span class="hljs-number">2280</span> &lt;puts@plt&gt;<br>    <span class="hljs-number">3287</span>:	b8 <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x0,%eax<br>    328c:	e8 f7 f8 ff ff       	<span class="hljs-keyword">call</span>   2b88 &lt;secret_phase&gt;<br>    <span class="hljs-number">3291</span>:	eb ad                	<span class="hljs-keyword">jmp</span>    <span class="hljs-number">3240</span> &lt;phase_defused+<span class="hljs-number">0x54</span>&gt;<br>    <span class="hljs-number">3293</span>:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">3d</span> 7e <span class="hljs-number">22</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x227e</span>(%rip),%rdi        # <span class="hljs-number">5518</span> &lt;array<span class="hljs-number">.0</span>+<span class="hljs-number">0x1d8</span>&gt;<br>    329a:	e8 e1 ef ff ff       	<span class="hljs-keyword">call</span>   <span class="hljs-number">2280</span> &lt;puts@plt&gt;<br>    329f:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">3d</span> <span class="hljs-number">22</span> <span class="hljs-number">22</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x2222</span>(%rip),%rdi        # 54c8 &lt;array<span class="hljs-number">.0</span>+<span class="hljs-number">0x188</span>&gt;<br>    32a6:	e8 d5 ef ff ff       	<span class="hljs-keyword">call</span>   <span class="hljs-number">2280</span> &lt;puts@plt&gt;<br>    32ab:	eb <span class="hljs-number">93</span>                	<span class="hljs-keyword">jmp</span>    <span class="hljs-number">3240</span> &lt;phase_defused+<span class="hljs-number">0x54</span>&gt;<br></code></pre></td></tr></table></figure>

<p>由于我们的前六个 phase 都已顺利破解，并没有调用 <code>exit</code>，因此开启 secret_phase 的关键在于步骤 7。步骤 7 要求 <code>num_input_strings</code> 的值为 6，而这个值正是我们在前面的 phase 2 和 phase 6 中输入的数字数量。可见 secret phase 的只有可能在 phase 2 和 phase 6 之后触发。</p>
<h2 id="abracadabra"><a href="#abracadabra" class="headerlink" title="abracadabra"></a>abracadabra</h2><ol>
<li>函数起始，执行<code>endbr64</code>安全指令，随后在栈上分配<code>0x98</code>字节空间</li>
<li>从<code>%fs:0x28</code>（栈金丝雀存储位置）读取值到<code>%rax</code>，并将其保存到栈上<code>0x88(%rsp)</code>位置</li>
<li>将<code>%eax</code>清零，准备后续操作</li>
</ol>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-number">0000000000002684</span> &lt;abracadabra&gt;:<br>    <span class="hljs-number">2684</span>:	f3 0f 1e fa          	endbr64<br>    <span class="hljs-number">2688</span>:	<span class="hljs-number">48</span> <span class="hljs-number">81</span> ec <span class="hljs-number">98</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">sub</span>    <span class="hljs-number">$0</span>x98,%rsp<br>    268f:	<span class="hljs-number">64</span> <span class="hljs-number">48</span> 8b <span class="hljs-number">04</span> <span class="hljs-number">25</span> <span class="hljs-number">28</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">mov</span>    %fs:<span class="hljs-number">0x28</span>,%rax<br>    <span class="hljs-number">2696</span>:	<span class="hljs-number">00</span> <span class="hljs-number">00</span><br>    <span class="hljs-number">2698</span>:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> <span class="hljs-number">84</span> <span class="hljs-number">24</span> <span class="hljs-number">88</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">mov</span>    %rax,<span class="hljs-number">0x88</span>(%rsp)<br>    269f:	<span class="hljs-number">00</span><br>    26a0:	<span class="hljs-number">31</span> c0                	<span class="hljs-keyword">xor</span>    %eax,%eax<br>    <span class="hljs-comment">; ...</span><br></code></pre></td></tr></table></figure>

<ol start="4">
<li><p>加载地址到寄存器，设置<code>sscanf</code>参数：</p>
<ul>
<li><code>%rcx</code> &#x3D; <code>0xc(%rsp)</code>（第三个输出参数地址）</li>
<li><code>%rdx</code> &#x3D; <code>0x8(%rsp)</code>（第二个输出参数地址）</li>
<li><code>%r8</code> &#x3D; <code>0x10(%rsp)</code>（第一个输出参数地址）</li>
<li><code>%rsi</code> &#x3D; 格式字符串地址（<code>0x2aa3(%rip)</code>，即<code>515b</code>）</li>
<li><code>%rdi</code> &#x3D; 输入字符串地址（<code>0x7089(%rip)</code>，即<code>9748</code>，属于<code>input_strings</code>）</li>
</ul>
</li>
<li><p>调用<code>__isoc99_sscanf</code>函数，解析输入字符串并将结果存入栈上<code>0x8</code>、<code>0xc</code>、<code>0x10</code>位置</p>
<div class="note note-info">
            <p>通过调试发现，调用 <code>__isoc99_sscanf</code> 前，<code>%rsi</code> 处储存的格式字符串为<code>&quot;%d %d %s&quot;</code>，而 <code>%rdi</code> 处储存的输入字符串为正是 phase 4 的输入。</p> 
          </div></li>
</ol>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-number">0000000000002684</span> &lt;abracadabra&gt;:<br>    <span class="hljs-comment">; ...</span><br>    26a2:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> 4c <span class="hljs-number">24</span> 0c       	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0xc</span>(%rsp),%rcx<br>    26a7:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">54</span> <span class="hljs-number">24</span> <span class="hljs-number">08</span>       	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x8</span>(%rsp),%rdx<br>    26ac:	4c <span class="hljs-number">8d</span> <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">10</span>       	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x10</span>(%rsp),%r8<br>    26b1:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">35</span> a3 2a <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x2aa3</span>(%rip),%rsi        # 515b &lt;_IO_stdin_used+<span class="hljs-number">0x15b</span>&gt;<br>    26b8:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">3d</span> <span class="hljs-number">89</span> <span class="hljs-number">70</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x7089</span>(%rip),%rdi        # <span class="hljs-number">9748</span> &lt;input_strings+<span class="hljs-number">0x168</span>&gt;<br>    26bf:	e8 9c fc ff ff       	<span class="hljs-keyword">call</span>   <span class="hljs-number">2360</span> &lt;__isoc99_sscanf@plt&gt;<br>    <span class="hljs-comment">; ...</span><br></code></pre></td></tr></table></figure>

<ol start="6">
<li><p>检查<code>sscanf</code>返回值（<code>%eax</code>）是否等于<code>3</code>（成功匹配 3 个值）：</p>
<ul>
<li>若等于<code>3</code>（<code>je</code>），跳至步骤 7</li>
<li>若不等于<code>3</code>，设置<code>%eax</code>为<code>0</code>，跳至步骤 9</li>
</ul>
</li>
<li><p>设置参数调用<code>strings_not_equal</code>函数：</p>
<ul>
<li><code>%rdi</code> &#x3D; 栈上<code>0x10</code>位置（第三个解析结果）</li>
<li><code>%rsi</code> &#x3D; 目标字符串地址（<code>0x2a73(%rip)</code>，即<code>5168</code>）</li>
</ul>
<div class="note note-info">
            <p>调试可知，<code>0x2a73(%rip)</code> 处的字符串为<code>&quot;...VeniVidiViciTwoThousandYearsAgo?&quot;</code>。</p> 
          </div>
</li>
<li><p>检查<code>strings_not_equal</code>返回值（<code>%eax</code>）：</p>
<ul>
<li>若返回<code>0</code>（字符串相等，<code>je</code>），设置<code>%eax</code>为<code>1</code>，跳至步骤 9</li>
<li>若返回非<code>0</code>（字符串不相等），设置<code>%eax</code>为<code>0</code>，跳至步骤 9</li>
</ul>
</li>
<li><p>进行栈溢出检查：</p>
<ul>
<li>从栈上<code>0x88(%rsp)</code>取出之前保存的栈金丝雀，与<code>%fs:0x28</code>原值比较</li>
<li>若不等（<code>jne</code>），调用<code>__stack_chk_fail</code>处理栈溢出</li>
<li>若相等，恢复栈空间（<code>add $0x98,%rsp</code>）并返回（<code>ret</code>）</li>
</ul>
</li>
</ol>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-number">0000000000002684</span> &lt;abracadabra&gt;:<br>    <span class="hljs-comment">; ...</span><br>    26c4:	<span class="hljs-number">83</span> f8 <span class="hljs-number">03</span>             	<span class="hljs-keyword">cmp</span>    <span class="hljs-number">$0</span>x3,%eax<br>    26c7:	<span class="hljs-number">74</span> <span class="hljs-number">20</span>                	<span class="hljs-keyword">je</span>     26e9 &lt;abracadabra+<span class="hljs-number">0x65</span>&gt;<br>    26c9:	b8 <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x0,%eax<br>    26ce:	<span class="hljs-number">48</span> 8b <span class="hljs-number">94</span> <span class="hljs-number">24</span> <span class="hljs-number">88</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">mov</span>    <span class="hljs-number">0x88</span>(%rsp),%rdx<br>    26d5:	<span class="hljs-number">00</span><br>    26d6:	<span class="hljs-number">64</span> <span class="hljs-number">48</span> 2b <span class="hljs-number">14</span> <span class="hljs-number">25</span> <span class="hljs-number">28</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">sub</span>    %fs:<span class="hljs-number">0x28</span>,%rdx<br>    26<span class="hljs-built_in">dd</span>:	<span class="hljs-number">00</span> <span class="hljs-number">00</span><br>    26df:	<span class="hljs-number">75</span> 2b                	<span class="hljs-keyword">jne</span>    270c &lt;abracadabra+<span class="hljs-number">0x88</span>&gt;<br>    26e1:	<span class="hljs-number">48</span> <span class="hljs-number">81</span> c4 <span class="hljs-number">98</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">add</span>    <span class="hljs-number">$0</span>x98,%rsp<br>    26e8:	c3                   	<span class="hljs-keyword">ret</span><br>    26e9:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> 7c <span class="hljs-number">24</span> <span class="hljs-number">10</span>       	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x10</span>(%rsp),%rdi<br>    26ee:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">35</span> <span class="hljs-number">73</span> 2a <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x2a73</span>(%rip),%rsi        # <span class="hljs-number">5168</span> &lt;_IO_stdin_used+<span class="hljs-number">0x168</span>&gt;<br>    26f5:	e8 d4 <span class="hljs-number">05</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2cce &lt;strings_not_equal&gt;<br>    26fa:	<span class="hljs-number">85</span> c0                	<span class="hljs-keyword">test</span>   %eax,%eax<br>    26fc:	<span class="hljs-number">74</span> <span class="hljs-number">07</span>                	<span class="hljs-keyword">je</span>     <span class="hljs-number">2705</span> &lt;abracadabra+<span class="hljs-number">0x81</span>&gt;<br>    26fe:	b8 <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x0,%eax<br>    <span class="hljs-number">2703</span>:	eb c9                	<span class="hljs-keyword">jmp</span>    26ce &lt;abracadabra+<span class="hljs-number">0x4a</span>&gt;<br>    <span class="hljs-number">2705</span>:	b8 <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x1,%eax<br>    270a:	eb c2                	<span class="hljs-keyword">jmp</span>    26ce &lt;abracadabra+<span class="hljs-number">0x4a</span>&gt;<br>    270c:	e8 9f fb ff ff       	<span class="hljs-keyword">call</span>   22b0 &lt;__stack_chk_fail@plt&gt;<br></code></pre></td></tr></table></figure>

<p>因此，我们需要在 phase 4 的输入的两个数字后，添加一个字符串：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">...VeniVidiViciTwoThousandYearsAgo?<br></code></pre></td></tr></table></figure>

<h2 id="alohomora"><a href="#alohomora" class="headerlink" title="alohomora"></a>alohomora</h2><ol>
<li>函数起始，执行<code>endbr64</code>安全指令，随后在栈上分配<code>0x88</code>字节空间</li>
<li>从<code>%fs:0x28</code>（栈金丝雀存储位置）读取值到<code>%rax</code>，并将其保存到栈上<code>0x78(%rsp)</code>位置</li>
<li>将<code>%eax</code>清零（<code>xor %eax,%eax</code>），准备后续操作</li>
</ol>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-number">0000000000002711</span> &lt;alohomora&gt;:<br>    <span class="hljs-number">2711</span>:	f3 0f 1e fa          	endbr64<br>    <span class="hljs-number">2715</span>:	<span class="hljs-number">48</span> <span class="hljs-number">81</span> ec <span class="hljs-number">88</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">sub</span>    <span class="hljs-number">$0</span>x88,%rsp<br>    271c:	<span class="hljs-number">64</span> <span class="hljs-number">48</span> 8b <span class="hljs-number">04</span> <span class="hljs-number">25</span> <span class="hljs-number">28</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">mov</span>    %fs:<span class="hljs-number">0x28</span>,%rax<br>    <span class="hljs-number">2723</span>:	<span class="hljs-number">00</span> <span class="hljs-number">00</span><br>    <span class="hljs-number">2725</span>:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">78</span>       	<span class="hljs-keyword">mov</span>    %rax,<span class="hljs-number">0x78</span>(%rsp)<br>    272a:	<span class="hljs-number">31</span> c0                	<span class="hljs-keyword">xor</span>    %eax,%eax<br>    <span class="hljs-comment">; ...</span><br></code></pre></td></tr></table></figure>

<ol start="4">
<li><p>计算输入字符串地址：通过<code>lea 0x6f25(%rip),%rax</code>获取<code>input_strings+0x78</code>，并跳转至步骤 5</p>
<div class="note note-info">
            <p>通过调试发现，<code>%rax</code> 处储存的字符串为正是 phase 2 的输入。</p> 
          </div>
</li>
<li><p>遍历字符串寻找结束符：</p>
<ul>
<li>检查<code>%rax</code>指向的字节是否为<code>0x0</code>（字符串结束符）</li>
<li>若不是（<code>jne</code>），将<code>%rax</code>加<code>1</code>（移动到下一个字符），重复检查</li>
<li>若是，将<code>%rax</code>减<code>1</code>（回退到最后一个有效字符）</li>
</ul>
</li>
</ol>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-number">0000000000002711</span> &lt;alohomora&gt;:<br>    <span class="hljs-comment">; ...</span><br>    272c:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">05</span> <span class="hljs-number">25</span> 6f <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x6f25</span>(%rip),%rax        # <span class="hljs-number">9658</span> &lt;input_strings+<span class="hljs-number">0x78</span>&gt;<br>    <span class="hljs-number">2733</span>:	eb <span class="hljs-number">04</span>                	<span class="hljs-keyword">jmp</span>    <span class="hljs-number">2739</span> &lt;alohomora+<span class="hljs-number">0x28</span>&gt;<br>    <span class="hljs-number">2735</span>:	<span class="hljs-number">48</span> <span class="hljs-number">83</span> c0 <span class="hljs-number">01</span>          	<span class="hljs-keyword">add</span>    <span class="hljs-number">$0</span>x1,%rax<br>    <span class="hljs-number">2739</span>:	<span class="hljs-number">80</span> <span class="hljs-number">38</span> <span class="hljs-number">00</span>             	cmpb   <span class="hljs-number">$0</span>x0,(%rax)<br>    273c:	<span class="hljs-number">75</span> f7                	<span class="hljs-keyword">jne</span>    <span class="hljs-number">2735</span> &lt;alohomora+<span class="hljs-number">0x24</span>&gt;<br>    273e:	<span class="hljs-number">48</span> <span class="hljs-number">83</span> e8 <span class="hljs-number">01</span>          	<span class="hljs-keyword">sub</span>    <span class="hljs-number">$0</span>x1,%rax<br>    <span class="hljs-comment">; ...</span><br></code></pre></td></tr></table></figure>

<ol start="6">
<li>初始化目标缓冲区指针：将栈顶地址（<code>%rsp</code>）赋给<code>%rdx</code>（作为新字符串的存储起始位置），跳转至步骤 7</li>
<li>反向复制字符串（从原字符串末尾向起始位置）：<ul>
<li>读取<code>%rax</code>指向的字符到<code>%ecx</code>（<code>movzbl (%rax),%ecx</code>）</li>
<li>检查该字符是否为空格（<code>0x20</code>）：<ul>
<li>若是（<code>je</code>），跳转至步骤 8（结束复制）</li>
<li>若不是，检查<code>%rax</code>是否未到达原字符串起始地址（<code>%rsi</code>）：<ul>
<li>若未到达（<code>jne</code>），将字符存入<code>%rdx</code>指向的栈缓冲区，<code>%rdx</code>加<code>1</code>（移动缓冲区指针），<code>%rax</code>减<code>1</code>（移动原字符串指针到前一个字符），重复步骤 7</li>
<li>若已到达，跳转至步骤 8</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>为新字符串添加结束符：在<code>%rdx</code>指向的位置写入<code>0x0</code>（<code>movb $0x0,(%rdx)</code>）</li>
</ol>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-number">0000000000002711</span> &lt;alohomora&gt;:<br>    <span class="hljs-comment">; ...</span><br>    <span class="hljs-number">2742</span>:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> e2             	<span class="hljs-keyword">mov</span>    %rsp,%rdx<br>    <span class="hljs-number">2745</span>:	eb 0a                	<span class="hljs-keyword">jmp</span>    <span class="hljs-number">2751</span> &lt;alohomora+<span class="hljs-number">0x40</span>&gt;<br>    <span class="hljs-number">2747</span>:	<span class="hljs-number">88</span> 0a                	<span class="hljs-keyword">mov</span>    %cl,(%rdx)<br>    <span class="hljs-number">2749</span>:	<span class="hljs-number">48</span> <span class="hljs-number">83</span> c2 <span class="hljs-number">01</span>          	<span class="hljs-keyword">add</span>    <span class="hljs-number">$0</span>x1,%rdx<br>    <span class="hljs-number">274d</span>:	<span class="hljs-number">48</span> <span class="hljs-number">83</span> e8 <span class="hljs-number">01</span>          	<span class="hljs-keyword">sub</span>    <span class="hljs-number">$0</span>x1,%rax<br>    <span class="hljs-number">2751</span>:	0f b6 <span class="hljs-number">08</span>             	movzbl (%rax),%ecx<br>    <span class="hljs-number">2754</span>:	<span class="hljs-number">80</span> f9 <span class="hljs-number">20</span>             	<span class="hljs-keyword">cmp</span>    <span class="hljs-number">$0</span>x20,%cl<br>    <span class="hljs-number">2757</span>:	<span class="hljs-number">74</span> 0c                	<span class="hljs-keyword">je</span>     <span class="hljs-number">2765</span> &lt;alohomora+<span class="hljs-number">0x54</span>&gt;<br>    <span class="hljs-number">2759</span>:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">35</span> f8 6e <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x6ef8</span>(%rip),%rsi        # <span class="hljs-number">9658</span> &lt;input_strings+<span class="hljs-number">0x78</span>&gt;<br>    <span class="hljs-number">2760</span>:	<span class="hljs-number">48</span> <span class="hljs-number">39</span> f0             	<span class="hljs-keyword">cmp</span>    %rsi,%rax<br>    <span class="hljs-number">2763</span>:	<span class="hljs-number">75</span> e2                	<span class="hljs-keyword">jne</span>    <span class="hljs-number">2747</span> &lt;alohomora+<span class="hljs-number">0x36</span>&gt;<br>    <span class="hljs-number">2765</span>:	c6 <span class="hljs-number">02</span> <span class="hljs-number">00</span>             	movb   <span class="hljs-number">$0</span>x0,(%rdx)<br>    <span class="hljs-comment">; ...</span><br></code></pre></td></tr></table></figure>

<ol start="9">
<li>比较字符串：调用<code>strings_not_equal</code>函数，比较栈上的新字符串（<code>%rdi=%rsp</code>）与目标字符串（<code>%rsi=0x2a1e(%rip)</code>）<div class="note note-info">
            <p>调试可知，<code>0x2a1e(%rip)</code> 处的目标字符串为<code>&quot;...diaSecnOraseaCsuiluJsuiaGtahTwonKUoD&quot;</code>。</p> 
          </div></li>
<li>根据比较结果设置返回值：<ul>
<li>若字符串相等（<code>strings_not_equal</code>返回<code>0</code>，<code>je</code>），设置<code>%eax</code>为<code>1</code></li>
<li>若字符串不相等，设置<code>%eax</code>为<code>0</code></li>
</ul>
</li>
<li>进行栈溢出检查：<ul>
<li>从栈上<code>0x78(%rsp)</code>取出之前保存的栈金丝雀，与<code>%fs:0x28</code>原值比较</li>
<li>若不等（<code>jne</code>），调用<code>__stack_chk_fail</code>处理栈溢出</li>
<li>若相等，恢复栈空间（<code>add $0x88,%rsp</code>）并返回（<code>ret</code>）</li>
</ul>
</li>
</ol>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-number">0000000000002711</span> &lt;alohomora&gt;:<br>    <span class="hljs-comment">; ...</span><br>    <span class="hljs-number">2768</span>:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> e7             	<span class="hljs-keyword">mov</span>    %rsp,%rdi<br>    276b:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">35</span> 1e 2a <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x2a1e</span>(%rip),%rsi        # <span class="hljs-number">5190</span> &lt;_IO_stdin_used+<span class="hljs-number">0x190</span>&gt;<br>    <span class="hljs-number">2772</span>:	e8 <span class="hljs-number">57</span> <span class="hljs-number">05</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2cce &lt;strings_not_equal&gt;<br>    <span class="hljs-number">2777</span>:	<span class="hljs-number">85</span> c0                	<span class="hljs-keyword">test</span>   %eax,%eax<br>    <span class="hljs-number">2779</span>:	<span class="hljs-number">74</span> <span class="hljs-number">1d</span>                	<span class="hljs-keyword">je</span>     <span class="hljs-number">2798</span> &lt;alohomora+<span class="hljs-number">0x87</span>&gt;<br>    277b:	b8 <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x0,%eax<br>    <span class="hljs-number">2780</span>:	<span class="hljs-number">48</span> 8b <span class="hljs-number">54</span> <span class="hljs-number">24</span> <span class="hljs-number">78</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">0x78</span>(%rsp),%rdx<br>    <span class="hljs-number">2785</span>:	<span class="hljs-number">64</span> <span class="hljs-number">48</span> 2b <span class="hljs-number">14</span> <span class="hljs-number">25</span> <span class="hljs-number">28</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">sub</span>    %fs:<span class="hljs-number">0x28</span>,%rdx<br>    278c:	<span class="hljs-number">00</span> <span class="hljs-number">00</span><br>    278e:	<span class="hljs-number">75</span> 0f                	<span class="hljs-keyword">jne</span>    279f &lt;alohomora+<span class="hljs-number">0x8e</span>&gt;<br>    <span class="hljs-number">2790</span>:	<span class="hljs-number">48</span> <span class="hljs-number">81</span> c4 <span class="hljs-number">88</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">add</span>    <span class="hljs-number">$0</span>x88,%rsp<br>    <span class="hljs-number">2797</span>:	c3                   	<span class="hljs-keyword">ret</span><br>    <span class="hljs-number">2798</span>:	b8 <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x1,%eax<br>    <span class="hljs-number">279d</span>:	eb e1                	<span class="hljs-keyword">jmp</span>    <span class="hljs-number">2780</span> &lt;alohomora+<span class="hljs-number">0x6f</span>&gt;<br>    279f:	e8 0c fb ff ff       	<span class="hljs-keyword">call</span>   22b0 &lt;__stack_chk_fail@plt&gt;<br></code></pre></td></tr></table></figure>

<p>因此，我们需要在 phase 2 的输入中，添加一个字符串：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">DoUKnowThatGaiusJuliusCaesarOnceSaid...<br></code></pre></td></tr></table></figure>

<h2 id="secret-phase"><a href="#secret-phase" class="headerlink" title="secret_phase"></a>secret_phase</h2><ol>
<li>函数起始，执行<code>endbr64</code>安全指令，随后将<code>%rbx</code>寄存器入栈保存，并在栈上分配<code>0x10</code>字节空间</li>
<li>从<code>%fs:0x28</code>（栈金丝雀存储位置）读取值到<code>%rax</code>，并将其保存到栈上<code>0x8(%rsp)</code>位置</li>
<li>将<code>%eax</code>清零（<code>xor %eax,%eax</code>），准备后续操作</li>
</ol>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">0000000000002b88 &lt;secret_phase&gt;:<br>    2b88:	f3 0f 1e fa          	endbr64<br>    2b8c:	<span class="hljs-number">53</span>                   	<span class="hljs-keyword">push</span>   %rbx<br>    2b8d:	<span class="hljs-number">48</span> <span class="hljs-number">83</span> ec <span class="hljs-number">10</span>          	<span class="hljs-keyword">sub</span>    <span class="hljs-number">$0</span>x10,%rsp<br>    2b91:	<span class="hljs-number">64</span> <span class="hljs-number">48</span> 8b <span class="hljs-number">04</span> <span class="hljs-number">25</span> <span class="hljs-number">28</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">mov</span>    %fs:<span class="hljs-number">0x28</span>,%rax<br>    2b98:	<span class="hljs-number">00</span> <span class="hljs-number">00</span><br>    2b9a:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">08</span>       	<span class="hljs-keyword">mov</span>    %rax,<span class="hljs-number">0x8</span>(%rsp)<br>    2b9f:	<span class="hljs-number">31</span> c0                	<span class="hljs-keyword">xor</span>    %eax,%eax<br>    <span class="hljs-comment">; ...</span><br></code></pre></td></tr></table></figure>

<ol start="4">
<li>调用<code>read_line</code>函数读取输入行，返回的输入字符串地址存入<code>%rax</code></li>
<li>设置<code>strtol</code>参数：<ul>
<li><code>%rdi</code> &#x3D; 输入字符串地址（<code>%rax</code>）</li>
<li><code>%edx</code> &#x3D; 基数<code>0xa</code>（十进制）</li>
<li><code>%esi</code> &#x3D; <code>0x0</code>（不保存结束指针）<br>调用<code>strtol@plt</code>将输入字符串以十进制转换为长整数，结果存入<code>%rbx</code></li>
</ul>
</li>
<li>加载<code>n1</code>的地址（<code>0x64ee(%rip)</code>）到<code>%rdi</code>，调用<code>get_sum</code>函数，其返回值存入<code>%eax</code><div class="note note-info">
            <p>我们无需关心 <code>n1</code> 的具体内容，也无需知道知道 <code>get_sum</code> 的逻辑。通过调试可得其返回值 <code>%eax</code> 为 62。</p> 
          </div></li>
<li>比较<code>get_sum</code>的返回值（<code>%eax</code>）与<code>strtol</code>转换的整数（<code>%ebx</code>）：<ul>
<li>若不等（<code>jne</code>），跳至步骤 8</li>
<li>若相等，继续步骤 9</li>
</ul>
</li>
<li>调用<code>explode_bomb</code>函数（触发炸弹爆炸），随后跳至步骤 9 中”打印信息”的起始位置</li>
</ol>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">0000000000002b88 &lt;secret_phase&gt;:<br>    <span class="hljs-comment">; ...</span><br>    2ba1:	e8 <span class="hljs-number">08</span> <span class="hljs-number">05</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   30ae &lt;read_line&gt;<br>    2ba6:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> c7             	<span class="hljs-keyword">mov</span>    %rax,%rdi<br>    2ba9:	ba 0a <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>xa,%edx<br>    2bae:	be <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x0,%esi<br>    2bb3:	e8 <span class="hljs-number">68</span> f7 ff ff       	<span class="hljs-keyword">call</span>   <span class="hljs-number">2320</span> &lt;strtol@plt&gt;<br>    2bb8:	<span class="hljs-number">48</span> <span class="hljs-number">89</span> c3             	<span class="hljs-keyword">mov</span>    %rax,%rbx<br>    2bbb:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">3d</span> ee <span class="hljs-number">64</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x64ee</span>(%rip),%rdi        # 90b0 &lt;n1&gt;<br>    2bc2:	e8 <span class="hljs-number">71</span> ff ff ff       	<span class="hljs-keyword">call</span>   2b38 &lt;get_sum&gt;<br>    2bc7:	<span class="hljs-number">39</span> d8                	<span class="hljs-keyword">cmp</span>    %ebx,%eax<br>    2bc9:	<span class="hljs-number">75</span> <span class="hljs-number">50</span>                	<span class="hljs-keyword">jne</span>    2c1b &lt;secret_phase+<span class="hljs-number">0x93</span>&gt;<br>    <span class="hljs-comment">; ...</span><br>    2c1b:	e8 c3 <span class="hljs-number">03</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br>    <span class="hljs-comment">; ...</span><br></code></pre></td></tr></table></figure>

<ol start="9">
<li>依次加载 4 个特定字符串地址到<code>%rdi</code>，并调用<code>puts</code>打印这些字符串</li>
<li>加载栈上<code>0x4(%rsp)</code>地址到<code>%rdi</code>，调用<code>phase_defused</code>函数</li>
<li>进行栈溢出检查：<ul>
<li>从栈上<code>0x8(%rsp)</code>取出之前保存的栈金丝雀，与<code>%fs:0x28</code>原值比较</li>
<li>若不等（<code>jne</code>），调用<code>__stack_chk_fail</code>处理栈溢出</li>
<li>若相等，恢复栈空间（<code>add $0x10,%rsp</code>），弹出<code>%rbx</code>寄存器并返回（<code>ret</code>）</li>
</ul>
</li>
</ol>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">0000000000002b88 &lt;secret_phase&gt;:<br>    <span class="hljs-comment">; ...</span><br>    2bcb:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">3d</span> 4e <span class="hljs-number">26</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x264e</span>(%rip),%rdi        # <span class="hljs-number">5220</span> &lt;_IO_stdin_used+<span class="hljs-number">0x220</span>&gt;<br>    2bd2:	e8 a9 f6 ff ff       	<span class="hljs-keyword">call</span>   <span class="hljs-number">2280</span> &lt;puts@plt&gt;<br>    2bd7:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">3d</span> 6a <span class="hljs-number">26</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x266a</span>(%rip),%rdi        # <span class="hljs-number">5248</span> &lt;_IO_stdin_used+<span class="hljs-number">0x248</span>&gt;<br>    2bde:	e8 <span class="hljs-number">9d</span> f6 ff ff       	<span class="hljs-keyword">call</span>   <span class="hljs-number">2280</span> &lt;puts@plt&gt;<br>    2be3:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">3d</span> a6 <span class="hljs-number">26</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x26a6</span>(%rip),%rdi        # <span class="hljs-number">5290</span> &lt;_IO_stdin_used+<span class="hljs-number">0x290</span>&gt;<br>    2bea:	e8 <span class="hljs-number">91</span> f6 ff ff       	<span class="hljs-keyword">call</span>   <span class="hljs-number">2280</span> &lt;puts@plt&gt;<br>    2bef:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> <span class="hljs-number">3d</span> d2 <span class="hljs-number">26</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x26d2</span>(%rip),%rdi        # 52c8 &lt;_IO_stdin_used+<span class="hljs-number">0x2c8</span>&gt;<br>    2bf6:	e8 <span class="hljs-number">85</span> f6 ff ff       	<span class="hljs-keyword">call</span>   <span class="hljs-number">2280</span> &lt;puts@plt&gt;<br>    2bfb:	<span class="hljs-number">48</span> <span class="hljs-number">8d</span> 7c <span class="hljs-number">24</span> <span class="hljs-number">04</span>       	<span class="hljs-keyword">lea</span>    <span class="hljs-number">0x4</span>(%rsp),%rdi<br>    2c00:	e8 e7 <span class="hljs-number">05</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   31ec &lt;phase_defused&gt;<br>    2c05:	<span class="hljs-number">48</span> 8b <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">08</span>       	<span class="hljs-keyword">mov</span>    <span class="hljs-number">0x8</span>(%rsp),%rax<br>    2c0a:	<span class="hljs-number">64</span> <span class="hljs-number">48</span> 2b <span class="hljs-number">04</span> <span class="hljs-number">25</span> <span class="hljs-number">28</span> <span class="hljs-number">00</span> 	<span class="hljs-keyword">sub</span>    %fs:<span class="hljs-number">0x28</span>,%rax<br>    2c11:	<span class="hljs-number">00</span> <span class="hljs-number">00</span><br>    2c13:	<span class="hljs-number">75</span> <span class="hljs-number">0d</span>                	<span class="hljs-keyword">jne</span>    2c22 &lt;secret_phase+<span class="hljs-number">0x9a</span>&gt;<br>    2c15:	<span class="hljs-number">48</span> <span class="hljs-number">83</span> c4 <span class="hljs-number">10</span>          	<span class="hljs-keyword">add</span>    <span class="hljs-number">$0</span>x10,%rsp<br>    2c19:	5b                   	<span class="hljs-keyword">pop</span>    %rbx<br>    2c1a:	c3                   	<span class="hljs-keyword">ret</span><br>    2c1b:	e8 c3 <span class="hljs-number">03</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       	<span class="hljs-keyword">call</span>   2fe3 &lt;explode_bomb&gt;<br>    2c20:	eb a9                	<span class="hljs-keyword">jmp</span>    2bcb &lt;secret_phase+<span class="hljs-number">0x43</span>&gt;<br>    2c22:	e8 <span class="hljs-number">89</span> f6 ff ff       	<span class="hljs-keyword">call</span>   22b0 &lt;__stack_chk_fail@plt&gt;<br></code></pre></td></tr></table></figure>

<p>因此，我们还需要在所有输入中新增一行，填入 secret phase 的答案：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">62<br></code></pre></td></tr></table></figure>

<hr>
<p><i class="iconfont icon-href"></i> <a target="_blank" rel="noopener" href="https://arthals.ink/blog/bomb-lab">更适合北大宝宝体质的 Bomb Lab 踩坑记</a></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/NOTE/" class="category-chain-item">NOTE</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/pku/" class="print-no-link">#pku</a>
      
        <a href="/tags/ics/" class="print-no-link">#ics</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>ICS - Bomb Lab | 拆弹！我吗？</div>
      <div>https://staaaaaaaaar.github.io/2025/10/14/ics-bomblab/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>Sam</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>October 14, 2025</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="NC - Non-commercial">
                    <i class="iconfont icon-cc-nc"></i>
                  </span>
                </a>
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="SA - Share-alike">
                    <i class="iconfont icon-cc-sa"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/10/17/fluid-stats-guide/" title="Fluid + LeanCloud | 启用网页统计配置">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Fluid + LeanCloud | 启用网页统计配置</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/10/13/blog-setup-guide/" title="Hexo + GitHub Pages | 有手就行的博客搭建指南">
                        <span class="hidden-mobile">Hexo + GitHub Pages | 有手就行的博客搭建指南</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> · <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        Views: 
        <span id="leancloud-site-pv"></span>
        
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        Visitors: 
        <span id="leancloud-site-uv"></span>
        
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
